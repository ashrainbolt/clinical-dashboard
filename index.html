<!DOCTYPE html>
<html lang="en" class="bg-gray-50 dark:bg-gray-900">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinical Dashboard</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide icons CDN -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <!-- Marked.js (Markdown parser) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* Custom styles for prose, layout, and new features */
        .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
            font-weight: 600;
            margin-top: 1.25em;
            margin-bottom: 0.5em;
        }
        .prose h1 { font-size: 1.5em; }
        .prose h2 { font-size: 1.25em; }
        .prose h3 { font-size: 1.1em; }
        .prose ul { list-style-type: disc; padding-left: 1.5em; }
        .prose ol { list-style-type: decimal; padding-left: 1.5em; }
        .prose strong { font-weight: 600; }
        .prose blockquote {
            border-left: 0.25rem solid #4f46e5;
            padding-left: 1em;
            font-style: italic;
            color: #4b5563;
        }
        .dark .prose blockquote {
            border-left-color: #818cf8;
            color: #d1d5db;
        }
        .prose .insight-link {
            color: #4f46e5;
            font-weight: 600;
            text-decoration: underline;
            cursor: pointer;
        }
        .dark .prose .insight-link {
            color: #a5b4fc;
        }

        .scratchpad-resize {
            resize: vertical;
            min-height: 10rem;
            max-height: 60vh;
            overflow-y: auto;
        }
        .sidebar-nav {
            flex: 1 1 auto;
            overflow-y: auto;
        }
        
        /* Modal Animation */
        .modal-hidden {
            display: none;
        }
        .modal-visible {
            display: flex;
        }
        .modal-content {
            transition: all 0.3s ease-out;
        }

        /* Card Animation */
        .card-container {
            transition: opacity 0.3s ease-in-out;
        }
        
        /* Interactive Checklist Styles */
        .interactive-checklist li {
            list-style-type: none;
            margin-left: -1.5em;
            display: flex;
            align-items: flex-start;
        }
        .interactive-checklist li label {
            cursor: pointer;
            display: flex;
            align-items: flex-start;
            width: 100%;
        }
        .interactive-checklist li .checkbox-custom {
            flex-shrink: 0;
            margin-top: 0.25em;
            margin-right: 0.75em;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid #6b7280;
            border-radius: 0.25rem;
            cursor: pointer;
            display: inline-block;
            position: relative;
        }
        .dark .interactive-checklist li .checkbox-custom {
            border-color: #9ca3af;
        }
        .interactive-checklist li input[type="checkbox"]:checked + .checkbox-custom {
            background-color: #4f46e5;
            border-color: #4f46e5;
        }
        .interactive-checklist li input[type="checkbox"]:checked + .checkbox-custom::after {
            content: 'âœ“';
            font-size: 1rem;
            color: white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .interactive-checklist li input[type="checkbox"] {
            display: none;
        }
        .interactive-checklist li .checkbox-text {
            flex: 1;
        }
        
        /* Collapsible Section Styles */
        .collapsible-header {
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .collapsible-header .lucide {
            transition: transform 0.3s ease;
        }
        .collapsible-header.collapsed .lucide {
            transform: rotate(-90deg);
        }
        .collapsible-content {
            max-height: 1000px; /* Or a large enough value */
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, visibility 0s linear 0s, opacity 0.3s ease;
            visibility: visible;
            opacity: 1;
        }
        .collapsible-content.collapsed {
            max-height: 0;
            visibility: hidden;
            opacity: 0;
            transition: max-height 0.3s ease-in-out, visibility 0s linear 0.3s, opacity 0.3s ease;
        }
        mark {
            background-color: #fef08a; /* yellow-200 */
            padding: 0.1em 0.2em;
            border-radius: 0.2em;
        }
        .dark mark {
            background-color: #facc15; /* yellow-400 */
            color: #1f2937; /* gray-800 */
        }
        
        /* Floating Scratchpad Styles */
        #floating-scratchpad-modal .drag-handle {
            cursor: move;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen font-sans">

    <!-- Sidebar -->
    <aside class="fixed left-0 top-0 h-full w-60 bg-white dark:bg-gray-800 shadow-lg flex flex-col z-40">
        <div class="flex items-center h-16 px-4 border-b border-gray-200 dark:border-gray-700 flex-shrink-0">
            <i data-lucide="activity" class="w-6 h-6 mr-2 text-indigo-500"></i>
            <span class="font-bold text-lg">Clinical OS</span>
            <button id="theme-toggle" class="ml-auto p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700" title="Toggle Theme">
                <i data-lucide="moon" class="w-5 h-5"></i>
            </button>
        </div>
        <nav class="sidebar-nav py-4 px-2 space-y-1">
            <button class="sidebar-link w-full text-left px-4 py-2 rounded flex items-center hover:bg-indigo-100 dark:hover:bg-indigo-900" data-tab="dashboard"><i data-lucide="layout-dashboard" class="w-4 h-4 mr-3"></i>Dashboard</button>
            <button class="sidebar-link w-full text-left px-4 py-2 rounded flex items-center hover:bg-indigo-100 dark:hover:bg-indigo-900" data-tab="interventions"><i data-lucide="zap" class="w-4 h-4 mr-3"></i>Interventions</button>
            <button class="sidebar-link w-full text-left px-4 py-2 rounded flex items-center hover:bg-indigo-100 dark:hover:bg-indigo-900" data-tab="scripts"><i data-lucide="file-text" class="w-4 h-4 mr-3"></i>Scripts</button>
            <button class="sidebar-link w-full text-left px-4 py-2 rounded flex items-center hover:bg-indigo-100 dark:hover:bg-indigo-900" data-tab="psychoeducation"><i data-lucide="book-open" class="w-4 h-4 mr-3"></i>Psychoed</button>
            <button class="sidebar-link w-full text-left px-4 py-2 rounded flex items-center hover:bg-indigo-100 dark:hover:bg-indigo-900" data-tab="favorites"><i data-lucide="star" class="w-4 h-4 mr-3"></i>Favorites</button>
            <button class="sidebar-link w-full text-left px-4 py-2 rounded flex items-center hover:bg-indigo-100 dark:hover:bg-indigo-900" data-tab="recents"><i data-lucide="history" class="w-4 h-4 mr-3"></i>Recently Viewed</button>
            <button id="scratchpad-toggle-btn" class="sidebar-link w-full text-left px-4 py-2 rounded flex items-center hover:bg-teal-100 dark:hover:bg-teal-900" data-tab="scratchpad"><i data-lucide="edit-3" class="w-4 h-4 mr-3"></i>Scratchpad</button>
        </nav>
        <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex-shrink-0">
            <input id="search-box" type="text" placeholder="Search scenarios..." class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
        </div>
    </aside>

    <!-- Main content -->
    <main class="ml-60 min-h-screen p-6 md:p-8 transition-colors duration-300">
        <div class="flex justify-between items-center mb-4">
            <!-- Used this session -->
            <div id="used-this-session-container" class="flex-1"></div>
            <!-- In-Session Timer -->
            <div id="session-timer-container" class="flex items-center gap-2 p-2 rounded-lg bg-green-100 dark:bg-green-900 transition-colors duration-500">
                <i data-lucide="timer" class="w-5 h-5"></i>
                <span id="session-timer" class="font-mono font-semibold text-lg">00:00</span>
                <button id="timer-toggle-btn" title="Start/Pause Timer" class="p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                    <i data-lucide="play" class="w-4 h-4"></i>
                </button>
                <button id="timer-reset-btn" title="Reset Timer" class="p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                    <i data-lucide="rotate-cw" class="w-4 h-4"></i>
                </button>
            </div>
        </div>
        <!-- Dynamic content area -->
        <div id="content-area" class="card-container"></div>
    </main>

    <!-- Content Modal -->
    <div id="scenario-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm items-center justify-center z-50 p-4 modal-hidden">
        <div id="modal-content-wrapper" class="bg-white dark:bg-gray-800 rounded-lg shadow-2xl max-w-4xl w-full relative p-6 max-h-[90vh] flex flex-col modal-content opacity-0 scale-95">
            <div id="modal-context" class="flex flex-wrap gap-2 mb-3"></div>
            <div class="flex items-start mb-4">
                <h2 id="modal-title" class="text-2xl font-bold flex-1"></h2>
                <button id="close-modal" class="p-2 rounded-full text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <div id="modal-body" class="prose dark:prose-invert max-w-none overflow-y-auto pr-4 -mr-4 flex-1"></div>
            <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 flex items-center gap-2">
                 <button id="copy-modal-content-to-scratchpad" class="flex items-center text-xs px-3 py-1 bg-teal-100 dark:bg-teal-900 rounded-md text-teal-700 dark:text-teal-200 hover:bg-teal-200 dark:hover:bg-teal-800"><i data-lucide="plus-square" class="w-4 h-4 mr-1"></i>Copy to Scratchpad</button>
                 <button id="add-annotation-btn" class="flex items-center text-xs px-3 py-1 bg-yellow-100 dark:bg-yellow-900 rounded-md text-yellow-700 dark:text-yellow-200 hover:bg-yellow-200 dark:hover:bg-yellow-800"><i data-lucide="sticky-note" class="w-4 h-4 mr-1"></i>Add Note</button>
                 <div class="ml-auto flex gap-2">
                    <button id="modal-prev" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed"><i data-lucide="arrow-left" class="w-5 h-5"></i></button>
                    <button id="modal-next" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed"><i data-lucide="arrow-right" class="w-5 h-5"></i></button>
                 </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Access Add Modal -->
    <div id="quick-access-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm items-center justify-center z-50 p-4 modal-hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-2xl max-w-2xl w-full relative p-6 max-h-[90vh] flex flex-col modal-content opacity-0 scale-95">
            <div class="flex items-center mb-4">
                <h2 class="text-2xl font-bold flex-1">Add to Quick Access</h2>
                <button id="close-quick-access-modal" class="p-2 rounded-full text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <input id="quick-access-search" type="text" placeholder="Search all items..." class="w-full px-3 py-2 mb-4 rounded-lg border border-gray-300 dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            <div id="quick-access-list" class="flex-1 overflow-y-auto -mr-4 pr-4 space-y-2"></div>
        </div>
    </div>

    <!-- Annotation Modal -->
    <div id="annotation-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm items-center justify-center z-[60] p-4 modal-hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-2xl p-6 w-full max-w-lg modal-content opacity-0 scale-95">
            <h3 id="annotation-modal-title" class="text-lg font-semibold mb-4">Add/Edit Note</h3>
            <textarea id="annotation-textarea" class="w-full p-2 border border-gray-300 dark:bg-gray-700 dark:border-gray-600 rounded-lg text-sm" rows="6" placeholder="Your private notes for this item..."></textarea>
            <div class="flex justify-end gap-3 mt-4">
                <button id="annotation-cancel" class="px-4 py-2 rounded-md text-sm font-medium bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600">Cancel</button>
                <button id="annotation-save" class="px-4 py-2 rounded-md text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700">Save</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm items-center justify-center z-[60] p-4 modal-hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-2xl p-6 w-full max-w-sm modal-content opacity-0 scale-95">
            <h3 id="confirmation-title" class="text-lg font-semibold mb-4">Are you sure?</h3>
            <div id="confirmation-message" class="text-sm text-gray-600 dark:text-gray-300 mb-6"></div>
            <div class="flex justify-end gap-3">
                <button id="confirmation-cancel" class="px-4 py-2 rounded-md text-sm font-medium bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600">Cancel</button>
                <button id="confirmation-confirm" class="px-4 py-2 rounded-md text-sm font-medium text-white bg-red-600 hover:bg-red-700">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Floating Scratchpad -->
    <div id="floating-scratchpad-modal" class="fixed top-20 left-[20%] w-full max-w-xl z-[70] modal-hidden">
        <div id="floating-scratchpad-content" class="bg-white dark:bg-gray-800 rounded-lg shadow-2xl flex flex-col modal-content opacity-0 scale-95">
            <div class="drag-handle flex items-center p-4 border-b border-gray-200 dark:border-gray-700 cursor-move">
                <i data-lucide="edit-3" class="w-5 h-5 text-teal-500 mr-2"></i>
                <h2 class="text-xl font-bold flex-1">Scratchpad</h2>
                <button id="close-scratchpad-btn" class="p-2 rounded-full text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <div id="floating-scratchpad-body" class="p-6">
                <!-- Content will be injected here by renderFloatingScratchpad -->
            </div>
        </div>
    </div>


    <!-- Toast Notification -->
    <div id="toast" class="hidden"></div>

    <script>
    // ---- DATA ----
    const clinicalData = [
        // --- RED ZONE ---
        {
            id: 'red-suicidal-ideation',
            title: 'Suicidal Ideation â€“ Safety Assessment',
            category: 'Red Zone',
            emoji: 'ğŸš©',
            color: 'red',
            tags: ['suicide', 'safety', 'crisis', 'cssrs', 'assessment', 'red'],
            content: `### ASSESS\n"Before we go any deeper, **our priority is always your safety**. Iâ€™d like to ask a few questions that help us understand how youâ€™re doing and what kind of support might help keep you safe right now.\n\n1.  **Have you wished you were dead or that you could go to sleep and not wake up?**\n2.  **Have you actually had any thoughts of killing yourself?** (If yes, ask 3, 4, 5, 6. If no, go to 6).\n3.  **In the past 48 hours, have you been thinking about how you might do this?**\n4.  **In the past 48 hours, have you had these thoughts and had some intention of acting on them?**\n5.  **In the past 48 hours, have you started to work out any details for how to kill yourself? Do you intend to carry out this plan?**\n6.  **In the past 48 hours have you done anything to prepare to end your life?**\n\n*If Yes to 4, 5, or 6, ask scaling questions:*\n\n> \"On a scale of 1-5, one meaning you feel you can stay safe today, and five meaning that you're going to make an attempt today, where would you place yourself right now?\"\n\n*Reflect back answer:*\n* \"So a **four** means to me you have a plan and some intentions on acting on the plan, you just don't know when. Is that accurate?\"\n* \"A **three** means to me you have strong thoughts of wanting to die and have thought about ways you might act on it, but you don't have a specific plan. Did I get that right?\"\n* \"A **two** means to me that you have fleeting thoughts of wanting to end your life, but no plan or intention of acting on it.\"\n\nâ€œIâ€™m really glad you told me this. It takes a lot of strength to be this honest, and Iâ€™m here to help you figure it out.â€\n\n### SAFETY PLAN\n**Need to escalate:** \"Thank you for telling me that. If it sounds like things are starting to feel more intense or harder to manage on your own, Iâ€™d like to connect you with a Crisis Manager â€” who can better support you and help figure out the next steps to keep you safe.\"\n\n* **Warning Signs:** â€œWhat are some early signs you notice when things start to spiral?â€\n* **Internal Coping:** â€œWhat can you try on your own that sometimes helps, even a little?â€\n* **Social Distractions:** â€œWho or what helps you shift your focus â€” even briefly?â€\n* **People to Reach Out To:** â€œIf things feel too big to hold alone, who could you reach out to?â€\n* **Professional Resources:** â€œDo you have Charlie Healthâ€™s 24/7 crisis line saved in your phone?â€\n* **Safety at Home:** â€œIs there anything nearby that might feel unsafe to have around right now?â€\n* **Reasons to Stay:** â€œWhen things get dark, whatâ€™s something â€” or someone â€” that reminds you thereâ€™s still a reason to hang on?â€`
        },
        {
            id: 'red-self-harm',
            title: 'Self-Harm Urges (Non-Suicidal Self-Injury)',
            category: 'Red Zone',
            emoji: 'ğŸš©',
            color: 'red',
            tags: ['nssi', 'self-harm', 'urges', 'coping', 'safety', 'red'],
            content: `### Direct Check-In\nâ€œThank you for telling me. I need to ask: Are you having urges to hurt yourself right now?â€\n* **If yes (urge is present):** â€œOn a scale from 1 to 10, how strong is the urge right now, 10 being the strongest?â€\n* **If yes (recent self-harm action):** â€œWhat did you do, and how severe was it? Do you need any medical attention for that?â€\n\n### Clarify Intent\nâ€œWhen you self-harmed, was it because you wanted to die, or was it more about coping with pain or numbness?â€\n\n### Validate & Normalize\nâ€œThat urge makes sense given what youâ€™re carrying. A part of you is trying to survive and find relief, even if itâ€™s doing it in a way that ends up hurting you. Letâ€™s see if we can work with that part in a safer way.â€\n\n### Offer Alternatives & Coping Strategies\n* **Intense Physical Sensations:** â€œSometimes our body needs a very strong sensation to release that tension. We could try the **TIPP Skill for Rapid Distress Reduction**.â€\n* **â€œUrge Surfingâ€ Technique:** â€œRemember, urges are like waves â€” they build, peak, and eventually fall. Letâ€™s try to ride this wave out together using the **Name the Urge, Challenge the Urge** technique.â€\n* **Safe Physical Release:** â€œWould it help to rip up some paper, squeeze a stress ball, stomp your feet, or even scream into a pillow?â€\n\n### Harm Reduction (If urge is overwhelming)\n"I hear that the urge feels too strong to resist completely right now. The priority is to keep you as safe as possible. Is there a way to get through this moment with less harm? For example, instead of [more severe method], could you try holding ice very tightly, or drawing on your skin with a red marker?"\n\n### Commitment to Safety\nâ€œI know the urge is strong, but do you feel like you can stay safe tonight? Even if the urge comes back, can you promise me youâ€™ll try these coping steps or reach out for help before doing anything to hurt yourself?â€`
        },
        {
            id: 'red-hallucinations',
            title: 'Hallucinations or Disturbing Perceptual Experiences',
            category: 'Red Zone',
            emoji: 'ğŸš©',
            color: 'red',
            tags: ['psychosis', 'hallucinations', 'voices', 'paranoia', 'safety', 'red'],
            content: `### Acknowledge Experience (Donâ€™t Dismiss)\nâ€œThank you for telling me. I can imagine this feels really intense and scary. I want you to know Iâ€™m here with you, and I believe that youâ€™re experiencing this.â€\n\n### Safety Check (Calm & Direct)\nâ€œAre the things youâ€™re hearing or seeing telling you to hurt yourself or anyone else?â€\n\n### Orient to Present (Ground in Shared Reality)\nâ€œLetâ€™s try something together to bring you into the here and now with me, okay? Put your feet flat on the floor for me. Press them down a little and notice that sensation. Youâ€™re right here, in this moment, with me. Weâ€™re safe right now. We can try a **Simple Somatic Anchors** technique.â€\n\n### Calm Reassurance\nâ€œYouâ€™re doing really well. Iâ€™m going to stay right here with you. The things youâ€™re perceiving can feel real, but I want you to keep noticing the ground under your feet, the sound of my voice. Weâ€™re in the present moment.â€`
        },
        {
            id: 'red-medical-crisis',
            title: 'Acute Medical Crisis',
            category: 'Red Zone',
            emoji: 'ğŸš©',
            color: 'red',
            tags: ['medical', 'emergency', '911', 'crisis', 'safety', 'red'],
            content: `### Immediate Action â€“ Take Charge\nâ€œOkay, I see/hear that something serious might be happening physically. The most important thing right now is getting you medical help immediately.â€\n\n### Instruct to Call Emergency\nâ€œAre you able to call 911 (or your local emergency number) right now? Is there someone with you who can call for you?â€\n\n### Offer to Call\nâ€œIt sounds like you canâ€™t call on your own. Iâ€™m going to get you help. Do I have your permission to call 911 for you right now to get an ambulance?â€\n\n### Keep Them Engaged While Help Comes\nâ€œHelp is on the way. Iâ€™m right here with you. Try to stay as calm as you can â€“ focus on taking slow breaths with me if possible. Inâ€¦ and outâ€¦ nice and easy.â€`
        },
        {
            id: 'red-overdose',
            title: 'Substance Overdose or Severe Intoxication',
            category: 'Red Zone',
            emoji: 'ğŸš©',
            color: 'red',
            tags: ['overdose', 'substance', 'intoxication', 'emergency', '911', 'red'],
            content: `### Recognize Seriousness\nâ€œI can tell this is serious. Iâ€™m very concerned that you might be experiencing a medical emergency from substances.â€\n\n### Instruct to Call Emergency\nâ€œThis is urgent. Are you able to call 911 right now for medical attention? Or is there someone with you who can call?â€\n\n### Naloxone (If Opioid Overdose suspected)\nâ€œIf this might be an opioid overdose and if you or anyone there has Naloxone (Narcan) and knows how to use it, please use it now while we wait for the ambulance.â€\n\n### Keep Them Awake & Oriented\nâ€œStay with me, okay? Help is coming. Try to stay awake and keep talking to me. I know youâ€™re very drowsy, but focus on my voice.â€`
        },
        {
            id: 'red-unsafe-home',
            title: 'Unsafe Home Environment / Domestic Violence',
            category: 'Red Zone',
            emoji: 'ğŸš©',
            color: 'red',
            tags: ['dv', 'domestic violence', 'abuse', 'safety', 'home', 'red'],
            content: `### Express Empathy and Belief\nâ€œThank you for sharing this with me. I canâ€™t imagine how hard it was to say that out loud. I want you to know I believe you, and you didnâ€™t deserve any of this.â€\n\n### Assess Immediate Safety\nâ€œAre you safe right now? Is the person who hurt you nearby or likely to return soon?â€\n\n### Provide Control & Options\nâ€œYou know your situation best, and Iâ€™m here to support whatever you choose to do. For example, have you heard of the National Domestic Violence Hotline? They have advocates 24/7 at 1-800-799-7233 who can help you make a safety plan or find resources.â€\n\n### Empower & Validate\nâ€œYou are not alone and there are people who want to help. You deserve to be safe. None of this is your fault.â€`
        },
        {
            id: 'red-child-abuse',
            title: 'Child Abuse or Neglect Disclosure',
            category: 'Red Zone',
            emoji: 'ğŸš©',
            color: 'red',
            tags: ['child abuse', 'neglect', 'mandated reporter', 'cps', 'safety', 'red'],
            content: `### Respond with Care\nâ€œThank you for telling me that. I know itâ€™s not easy to talk about. I am so sorry this happened to you (or to that child). No one, especially no child, should have to go through that.â€\n\n### Explain Mandated Reporting (Transparent and Reassuring)\nâ€œI need you to know: because you shared this, Iâ€™m required by law to take steps to report it to the proper authorities... This isnâ€™t to get anyone in trouble; itâ€™s to protect you/them and make sure it doesnâ€™t continue.â€\n\n### Support the Clientâ€™s Emotions\nâ€œHow are you feeling now that youâ€™ve shared that? Itâ€™s a lot, I know. Whatever youâ€™re feeling â€“ scared, relieved, angry â€“ itâ€™s completely understandable.â€\n\n### Closing Reassurance\nâ€œI know this was a big step to tell me. You were very brave to speak up. Remember: you didnâ€™t do anything wrong by telling the truth.â€`
        },
        {
            id: 'red-harm-to-others',
            title: 'Threat of Harm to Others (Homicidal Ideation)',
            category: 'Red Zone',
            emoji: 'ğŸš©',
            color: 'red',
            tags: ['homicidal', 'harm to others', 'duty to protect', 'safety', 'crisis', 'red'],
            content: `### Immediate Clarification\nâ€œI hear you saying you want to hurt someone. I take that very seriously, and I need to ask you a few questions to understand better, because my job is to keep everyone safe.â€\n\n### Duty to Protect Explanation\nâ€œOkay, I need you to know: because youâ€™re talking about harming someone else, I have a responsibility to make sure that person (and everyone) stays safe. That may mean involving other professionals or authorities right away.â€\n\n### De-escalate Anger\nâ€œI get that youâ€™re extremely angry. That anger is telling us something important â€” you feel deeply hurt or wronged. Iâ€™m here to listen to that. Letâ€™s slow this down and sit with whatâ€™s coming up, instead of letting it boil over.â€`
        },
        {
            id: 'red-under-influence',
            title: 'Under the Influence (Non-Crisis)',
            category: 'Red Zone',
            emoji: 'ğŸš©',
            color: 'red',
            tags: ['substance', 'intoxication', 'policy', 'safety', 'red'],
            content: `### Immediate Safety Check\n"Hi. I'm just checking in with you briefly. It was noticed in group that [specific observation, e.g., 'you seemed a bit sleepy']. How are you doing right now?"\n\n### Stating the Need to Log Off (Clear, Kind, Firm)\n"Because it appears you're under the influence right now, and in line with the group policy for everyone's safety and benefit, I am going to need you to log off from the group session for the rest of today."\n"This isn't a punishment, but it's a necessary step to ensure your well-being and to maintain the group's therapeutic environment."\n\n### Brief Safety Assessment (Essential before log-off)\n"Before you log off for the day, my top priority is to make sure you're going to be safe. Are you in a safe place physically right now? Is there anyone with you, or someone responsible you can contact if you start to feel unwell or need help?"\n\n### Explain Next Steps\nâ€œBecause you were under the influence and had to step out of group, I will let your primary therapist know what happened, just so theyâ€™re in the loop and can support you.â€`
        },
        // --- ORANGE ZONE ---
        {
            id: 'orange-agitated',
            title: 'Highly Agitated or Escalating',
            category: 'Orange Zone',
            emoji: 'ğŸŸ ',
            color: 'orange',
            tags: ['agitation', 'escalation', 'anger', 'distress', 'orange'],
            content: `### Center and Slow the Moment\nâ€œI can see (or hear) how agitated you are. Letâ€™s take a pause for a second. Iâ€™m right here with you. You donâ€™t have to go through this moment alone.â€\n\n### Acknowledge the Anger/Frustration\nâ€œThat energy and anger youâ€™re feeling right now â€” it makes sense. Something important is going on inside you and itâ€™s demanding to be heard.â€\n\n### Explore the Underlying Need\n"Anger often acts as a protector for more vulnerable feelings. I wonder, if the anger could speak, what hurt or fear might be underneath it? What is it trying to tell us that you need right now? This is something we can explore using **Acknowledging an Emotional Part**."\n\n### Keep Voice Calm & Assuring\nâ€œIâ€™m not going anywhere. I know youâ€™re really upset, and itâ€™s okay. Letâ€™s stay right here. Youâ€™re safe with me to let it out, as long as we keep each other safe.â€\n\n### After Calming Slightly â€“ Reflection\nâ€œThat was a lot. You did really well slowing down just now. This is hard stuff, and youâ€™re handling it. When youâ€™re ready, maybe we can figure out what you need next or how I can help further.â€`
        },
        {
            id: 'orange-panic-attack',
            title: 'Acute Anxiety or Panic Attack',
            category: 'Orange Zone',
            emoji: 'ğŸŸ ',
            color: 'orange',
            tags: ['anxiety', 'panic', 'fear', 'grounding', 'tipp', 'orange'],
            content: `### Normalize & Reassure\nâ€œWhat youâ€™re experiencing is a panic attack. It feels really scary, but **I promise itâ€™s not life-threatening. You are going to be okay. Iâ€™m right here.**â€\n\n### Immediate Physiological Regulation\n* **Temperature:** "Let's try the **TIPP Skill for Rapid Distress Reduction**. Can you splash some cold water on your face, or hold a cold water bottle or ice cube if you have one? This triggers something called the 'dive response' that naturally slows your heart rate."\n* **Paced Breathing:** "Let's breathe together. Breathe in through your nose for 4 counts... hold for 4... now out through your mouth for 6 counts. That longer exhale is key."\n\n### Orient to Safety\nâ€œLetâ€™s ground ourselves in the room. We can use the **Grounding Through Senses (5-4-3-2-1 Technique)** or a technique called **Dropping Anchor (ACT)** to connect with the present moment.â€\n\n### Permission to Pause\nâ€œWe donâ€™t need to unpack everything right now. In fact, we shouldnâ€™t dive deeper into anything heavy at this moment, because I want to make sure you donâ€™t leave here feeling even worse.â€`
        },
        {
            id: 'orange-overwhelmed',
            title: 'Overwhelmed & Emotionally Flooded',
            category: 'Orange Zone',
            emoji: 'ğŸŸ ',
            color: 'orange',
            tags: ['overwhelmed', 'flooded', 'crying', 'shut down', 'orange'],
            content: `### Contain and Validate\nâ€œItâ€™s all feeling like too much, isnâ€™t it? I hear you. What youâ€™re experiencing right now makes so much sense given everything youâ€™re carrying. Anyone would feel overwhelmed in your shoes.â€\n\n### Permission to Pause\nâ€œWe donâ€™t need to unpack everything right now. In fact, we shouldnâ€™t dive deeper into anything heavy at this moment, because I want to make sure you donâ€™t leave here feeling even worse. Letâ€™s focus on just helping you feel a little steadier.â€\n\n### Grounding in Present\nâ€œCan you feel the chair under you, or your feet on the ground? Letâ€™s start there. Just notice those physical points of contact â€“ it might help bring you back just a little from the flood of feelings. We can try some **Simple Somatic Anchors**.â€\n\n### Supportive Reassurance\nâ€œIâ€™m right here, and Iâ€™m not overwhelmed by your overwhelm. You donâ€™t have to hold it together for my sake. Itâ€™s okay to let it out â€“ cry, sit silently, whatever you need. Iâ€™ve got you.â€`
        },
        {
            id: 'orange-dissociation',
            title: 'Dissociation / Depersonalization',
            category: 'Orange Zone',
            emoji: 'ğŸŸ ',
            color: 'orange',
            tags: ['dissociation', 'derealization', 'depersonalization', 'numb', 'unreal', 'grounding', 'orange'],
            content: `### Validate & Normalize\n"It sounds like you're feeling really disconnected, like you're watching yourself from a distance or things don't feel real. That's a very common, though unsettling, way our brains protect us from overwhelming feelings. It's called dissociation."\n\n### Gentle Re-orientation\n"You're not going crazy. This is a survival response. Our main job right now is to gently invite your awareness back into the present moment, without forcing anything."\n\n### Engage the Senses\n"Let's try to connect with one of our senses. Can you find one thing in the room that is a specific color, like blue? Just let your eyes rest on it. No need to do anything else, just notice it."\n\n### Intervention Insight\n* Use **Grounding Through Senses (5-4-3-2-1 Technique)** to re-engage with the environment.\n* Use **Simple Somatic Anchors** like pressing feet into the floor or holding a textured object.\n* Introduce **TIPP Skill for Rapid Distress Reduction**, especially the 'Temperature' component with cold water, to create a strong, grounding sensation.`
        },
        {
            id: 'orange-unusual-thoughts',
            title: 'Unusual Thoughts (Mild Paranoia or Cognitive Distortions)',
            category: 'Orange Zone',
            emoji: 'ğŸŸ ',
            color: 'orange',
            tags: ['paranoia', 'distortions', 'thoughts', 'reality testing', 'orange'],
            content: `### Do Not Dismiss\nâ€œThat sounds really troubling. It must feel scary (or confusing) thinking that might be true. Thank you for telling me whatâ€™s going through your mind.â€\n\n### Gently Reality-Check\nâ€œLetâ€™s look at that together. You feel like everyone in group hates you. I know it can really feel that way. May I share what Iâ€™ve observed? Iâ€™ve seen group members show you care... Iâ€™m not seeing evidence of hate.â€\n\n### Affirm\nâ€œYouâ€™re not â€˜crazyâ€™ or bad for having these thoughts. Our minds do all kinds of weird things under stress. The fact that you can question it and talk about it means you have insight and courage.â€\n\n### Intervention Insight\n* Use **Check the Facts (DBT)** to systematically evaluate if the emotion fits the situation.\n* Introduce **Thought Challenging - cognitive restructuring** to examine the evidence.`
        },
        {
            id: 'orange-trauma-reaction',
            title: 'Trauma Reaction / Flashback',
            category: 'Orange Zone',
            emoji: 'ğŸŸ ',
            color: 'orange',
            tags: ['trauma', 'flashback', 'ptsd', 'grounding', 'safety', 'orange'],
            content: `### Ground in Present Safety\nâ€œHey, youâ€™re here with me. Youâ€™re safe right now. That thing isnâ€™t happening to you right this second, even though it feels like it is.â€\n\n### Breathe and Orient\nâ€œTake a deep breath if you can. Youâ€™re breathing in the current year. Youâ€™re [clientâ€™s name], and youâ€™re here with me, not back in that situation. That was then, and this is now. Can you say out loud, â€˜Iâ€™m here nowâ€™?â€\n\n### Validate and Contain\nâ€œThat memory was really intense. It makes sense that it felt like it was happening all over again. Flashbacks can be that powerful. But itâ€™s not happening now, and you survived it then. Youâ€™re safe now.â€\n\n### Intervention Insight\n* Use **Dropping Anchor (ACT)** to acknowledge the internal storm while connecting to the physical room.\n* Use **Simple Somatic Anchors** to provide immediate physical grounding.`
        },
        {
            id: 'orange-sexual-assault',
            title: 'Sexual Assault Disclosure',
            category: 'Orange Zone',
            emoji: 'ğŸŸ ',
            color: 'orange',
            tags: ['sexual assault', 'trauma', 'disclosure', 'safety', 'support', 'orange'],
            content: `### Listen and Honor Courage\nâ€œIâ€™m so sorry that happened to you. Thank you for trusting me enough to tell me. I canâ€™t imagine how terrible that was for you, and how heavy it must be to carry that.â€\n\n### Validate the Response\nâ€œWhat happened is not your fault. You did not deserve that. The blame is 100% on the person who hurt you.â€\n\n### Empower Choices\nâ€œI want you to have control over what happens next. If you want help reporting it or getting medical care, I can help facilitate that. If you just wanted to tell someone and not take further action right now, thatâ€™s okay too.â€`
        },
        {
            id: 'orange-relational-rupture',
            title: 'Relational Rupture / Intense Interpersonal Conflict',
            category: 'Orange Zone',
            emoji: 'ğŸŸ ',
            color: 'orange',
            tags: ['conflict', 'relationship', 'anger', 'betrayal', 'communication', 'orange'],
            content: `### Validate the Hurt/Anger\nâ€œIt sounds like youâ€™re really hurt and angry about what happened. Thatâ€™s completely understandable â€“ when someone we care about [does X], it can feel awful and infuriating.â€\n\n### Prevent Overwhelm or Shutdown\nâ€œLetâ€™s try to slow it just a bit so I can understand everything. I want to make sure Iâ€™m catching whatâ€™s most important to you in all of this.â€\n\n### Brainstorm or Contain\nâ€œGiven how raw this is, it might be best not to confront them while youâ€™re feeling this angry. We can work out what you want to say when youâ€™re calmer. For now, maybe focus on what you need to feel a bit better.â€\n\n### Intervention Insight\n* Prepare for a future conversation using **DEAR MAN: For Interpersonal Effectiveness**.\n* Use the **Nonviolent Communication (NVC) Framework** to clarify feelings and needs before communicating.`
        },
        {
            id: 'orange-triggered-by-group',
            title: 'Triggered by Group Content',
            category: 'Orange Zone',
            emoji: 'ğŸŸ ',
            color: 'orange',
            tags: ['trigger', 'group', 'trauma', 'overwhelmed', 'orange'],
            content: `### Normalize Triggers\nâ€œIt makes a lot of sense that you felt triggered by what came up in group. Sometimes other peopleâ€™s stories can stir up feelings or memories we didnâ€™t expect. That doesnâ€™t mean anything is wrong with you â€“ it means youâ€™re human.â€\n\n### Re-ground and Stabilize\nâ€œLetâ€™s come back to the here and now first. Youâ€™re with me, youâ€™re safe. The group conversation is over (or on pause) and weâ€™re just sitting here talking. Let's try to use the **Grounding Through Senses (5-4-3-2-1 Technique)** to help.â€\n\n### Affirmation\nâ€œIâ€™m glad you took a break and talked to me about it. Thatâ€™s a healthy response to feeling overwhelmed. You honored your limits, and thatâ€™s good.â€`
        },
        {
            id: 'orange-conflict-in-group',
            title: 'Conflict in Group or with Staff',
            category: 'Orange Zone',
            emoji: 'ğŸŸ ',
            color: 'orange',
            tags: ['conflict', 'group', 'staff', 'anger', 'communication', 'orange'],
            content: `### Initial Response\n"It makes sense that youâ€™d feel activated after what happened in group. I want to hold space for that with you."\n\n### Plan a Constructive Follow-Up\nâ€œIf you feel up to it, we can talk about how to address this. Would you want to speak with [the person] one-on-one with a mediator, maybe me or your therapist, present? Or would you prefer writing down what you feel and sharing it? We could use the **DEAR MAN: For Interpersonal Effectiveness** script to prepare.â€\n\n### Affirm Self-Advocacy\nâ€œIâ€™m really glad you told me how you feel. You have every right to speak up when something isnâ€™t okay for you.â€`
        },
        {
            id: 'orange-anger-irritability',
            title: 'Anger and Irritability',
            category: 'Orange Zone',
            emoji: 'ğŸŸ ',
            color: 'orange',
            tags: ['anger', 'irritability', 'frustration', 'coping', 'orange'],
            content: `### Acknowledge the Emotion\nâ€œYouâ€™ve been feeling a lot of anger lately â€“ like a constant simmering. Thatâ€™s exhausting, isnâ€™t it? Itâ€™s okay to feel angry. Anger is a normal emotion. It often comes when we feel hurt, or trapped, or disrespected.â€\n\n### Invite Insight\nâ€œDo you have a sense of whatâ€™s underneath the anger? Often thereâ€™s pain or fear hiding under angerâ€™s umbrella.â€\n\n### Intervention Insight\n* Use **Circles of Control, Influence, and Concern** to help focus energy effectively.\n* Apply **Assertiveness Skills Training & Practice** for assertive expression.\n* Use **Check the Facts (DBT)** to see if the anger's intensity fits the situation.`
        },
        // --- YELLOW ZONE ---
        {
            id: 'yellow-resistant',
            title: 'Resistant / Ambivalent About Therapy',
            category: 'Yellow Zone',
            emoji: 'ğŸŸ¨',
            color: 'yellow',
            tags: ['resistance', 'ambivalence', 'motivation', 'therapy', 'yellow'],
            content: `### Acknowledge Autonomy\nâ€œItâ€™s okay if youâ€™re not sure about this or even if you donâ€™t want help right now. Youâ€™re in control here â€“ Iâ€™m not going to force anything on you.â€\n\n### Gently Explore Resistance\nâ€œCan I ask, whatâ€™s your biggest concern about accepting help? If youâ€™d rather not say, thatâ€™s fine, but if we talk about it, maybe we can address it together.â€\n\n### Affirm Their Pace\nâ€œWe can go as slow as you want. Maybe we donâ€™t dive into anything deep today. We could just chat about surface stuff or even sit in silence if that feels safer.â€\n\n### Intervention Insight\n* Use **Pros and Cons / Decisional Balance** to explore the costs and benefits of change versus staying the same.\n* Use **Solution-Focused Brief Therapy (SFBT) Techniques** like coping questions ("How have you managed so far?") to highlight existing strengths.`
        },
        {
            id: 'yellow-group-resistant',
            title: 'Group Resistant',
            category: 'Yellow Zone',
            emoji: 'ğŸŸ¨',
            color: 'yellow',
            tags: ['group', 'resistance', 'ambivalence', 'therapy', 'yellow'],
            content: `### Validate Concerns\n"It sounds like you're not really feeling the group setting right now. That's fair. Group therapy isn't for everyone, and it can definitely feel awkward or unproductive at times."\n\n### Explore Specifics\n"Can you tell me a bit more about what's not working for you in group? Is it the topics, the other people, the format? Understanding the specific issue can help us see if it's something we can adjust."\n\n### Reframe Group's Purpose\n"Let's reframe this: What if group isn't about 'fixing' everything, but about practicing new ways of relating to yourself and others, even when it's imperfect?â€\n\n### Empower Agency\n"This program asks a lot. And the reason it asks a lot is because the things you're working towards are significant. How can the group support you in meeting those demands today?â€`
        },
        {
            id: 'yellow-manipulative-behaviors',
            title: 'â€œManipulativeâ€ or Testing Behaviors',
            category: 'Yellow Zone',
            emoji: 'ğŸŸ¨',
            color: 'yellow',
            tags: ['manipulation', 'testing', 'boundaries', 'needs', 'yellow'],
            content: `### Look Under the Behavior\nâ€œIt seems like you really need something right now â€“ maybe reassurance, or to feel in control? I want to understand what you need, because I donâ€™t think youâ€™re doing these things for no reason.â€\n\n### Call Out Needs, Not Character\nâ€œI donâ€™t see you as â€˜manipulative.â€™ I see someone whoâ€™s trying hard to get their needs met. How about we skip the part where you have to escalate things to get me to care â€“ because I already care.â€\n\n### Encourage Direct Communication\nâ€œYou shouldnâ€™t have to test me to see if Iâ€™ll support you. I want you to know: if you need something, you can ask me as plainly as possible.â€\n\n### Intervention Insight\n* Use the **DEAR MAN: For Interpersonal Effectiveness** framework for clear, assertive communication.\n* Explore the **Nonviolent Communication (NVC) Framework** to connect behaviors to unmet needs.`
        },
        {
            id: 'yellow-shut-down',
            title: 'Shut Down, Withdrawn, or Minimizing',
            category: 'Yellow Zone',
            emoji: 'ğŸŸ¨',
            color: 'yellow',
            tags: ['withdrawn', 'shut down', 'minimizing', 'dissociation', 'yellow'],
            content: `### Gently Call It Out\nâ€œI notice youâ€™re getting really quiet (or you keep saying youâ€™re fine). Sometimes when people get really quiet, itâ€™s because the feelings are too much or too hard to put into words. Does that feel true for you right now?â€\n\n### Permission to Be Silent\nâ€œWe can sit here together without talking for a bit if thatâ€™s what you need. Iâ€™m not uncomfortable with the silence if you arenâ€™t. Sometimes just having someone nearby is enough.â€\n\n### Explore Connection\nâ€œLetâ€™s think of one small way to feel a bit more connected. Is there anyone â€“ even an acquaintance or a family member â€“ you could send a text to later today, just to say hi?â€\n\n### Affirmation\nâ€œIt took courage to admit how lonely you feel. Thatâ€™s a step toward change. You deserve to feel connected and valued â€“ because you are.â€\n\n### Intervention Insight\n* Gently introduce **Simple Somatic Anchors** to help the client reconnect with their body in a non-threatening way.\n* Consider introducing **Acknowledging an Emotional Part** to give voice to the part that needs to withdraw.`
        },
        {
            id: 'yellow-loneliness',
            title: 'Loneliness and Isolation',
            category: 'Yellow Zone',
            emoji: 'ğŸŸ¨',
            color: 'yellow',
            tags: ['loneliness', 'isolation', 'connection', 'depression', 'yellow'],
            content: `### Validate the Pain of Loneliness\nâ€œFeeling lonely can be incredibly painful. I hear you â€“ itâ€™s like youâ€™re aching for connection and itâ€™s nowhere to be found. Thatâ€™s a really heavy thing to carry.â€\n\n### Assure Them Theyâ€™re Not Alone Right Now\nâ€œWell, youâ€™re not alone at this exact moment. Iâ€™m here with you, and I care about what youâ€™re feeling. I know Iâ€™m just one person and not a long-term fix, but I want you to know, right now in this space, you are seen and heard.â€\n\n### Explore Opportunities for Connection (Gently)\nâ€œLetâ€™s think of one small way to feel a bit more connected. Is there anyone â€“ even an acquaintance or a family member â€“ you could send a text to later today, just to say hi? You donâ€™t have to spill your guts to them, just a simple connection.â€\n\n### Intervention Insight\n* Use **Behavioral Activation** to schedule small, connection-oriented activities.\n* Practice **Assertiveness Skills Training & Practice** to build confidence in initiating contact.`
        },
        {
            id: 'yellow-shame-guilt',
            title: 'Shame, Self-Hatred, or Guilt',
            category: 'Yellow Zone',
            emoji: 'ğŸŸ¨',
            color: 'yellow',
            tags: ['shame', 'guilt', 'self-compassion', 'worthlessness', 'yellow'],
            content: `### Validate\nâ€œIt sounds like youâ€™re holding yourself to an impossible standard. Whatever you did (or think you did), it doesnâ€™t make you worthless or evil. It makes you human.â€\n\n### Get Specific\nâ€œCan we talk about whatâ€™s making you feel so ashamed? What do you believe you did thatâ€™s so unforgivable?â€\n\n### Self-Compassion\nâ€œThink about what you would say to a close friend if they were feeling exactly what youâ€™re feeling. You deserve that same kindness. What if you tried talking to yourself in that gentle way, maybe saying something like â€˜Itâ€™s okay to feel this. Iâ€™m here for you.â€™?â€\n\n### Intervention Insight\n* Use **ACT Defusion: Distancing from Thoughts** ("I'm having the thought that...") to create distance from shaming thoughts.\n* Apply **Cognitive Reframing: Behavior vs. Identity** to separate actions from self-worth.\n* Practice the **Self-Compassion Break (Kristin Neff)**.`
        },
        {
            id: 'yellow-body-image',
            title: 'Body Image Issues',
            category: 'Yellow Zone',
            emoji: 'ğŸŸ¨',
            color: 'yellow',
            tags: ['body image', 'self-esteem', 'eating disorders', 'yellow'],
            content: `### Validate Feelings (Donâ€™t Dismiss)\nâ€œItâ€™s really hard to feel uncomfortable in your own body. Thatâ€™s a very real kind of pain. In a world that bombards us with certain images, itâ€™s no wonder you feel this way.â€\n\n### Gently Challenge Harsh Statements\nâ€œWhen you say, â€˜I hate my bodyâ€™ â€“ thatâ€™s a strong, blanket statement. I wonder, are there any parts of your body or things it does that you donâ€™t hate? Even something small, like â€˜I like my eyesâ€™ or â€˜my body gets me from place to place each dayâ€™?â€\n\n### Promote Body Neutrality over Negativity\nâ€œYou donâ€™t have to love your body right now â€“ that can feel impossible. Maybe we aim for neutrality first. For example, instead of â€˜I hate my legs,â€™ maybe â€˜My legs allow me to walk, even if I donâ€™t like how they look.â€™ Itâ€™s acknowledging their function without focusing on appearance.â€\n\n### Intervention Insight\n* Practice **Mindful Self-Compassion: Soothing Touch** to offer kindness to the body.\n* Use **Thought Challenging - cognitive restructuring** on the negative self-talk.`
        },
        {
            id: 'yellow-hopelessness',
            title: 'Hopelessness or Despair (without active suicidal intent)',
            category: 'Yellow Zone',
            emoji: 'ğŸŸ¨',
            color: 'yellow',
            tags: ['hopelessness', 'despair', 'depression', 'motivation', 'yellow'],
            content: `### Borrow Hope\nâ€œSometimes we have to borrow hope from others. Is it okay if I believe that things can change, even if you donâ€™t believe it today? Iâ€™ve seen people come out of pits like this, and I truly believe you can too.â€\n\n### Focus on Immediate Next Step\nâ€œWhen the future looks blank or bleak, donâ€™t even worry about the future right now. Letâ€™s just focus on getting through today, or even just the next hour.â€\n\n### Compassion\nâ€œEven if you canâ€™t feel hope right now, I have enough for both of us. I know youâ€™re tired. But youâ€™ve made it to this day, even carrying all that despair â€“ thatâ€™s not small thing.â€\n\n### Intervention Insight\n* Use **Behavioral Activation** to schedule one very small, simple, and achievable action.\n* Use **Solution-Focused Brief Therapy (SFBT) Techniques**, especially coping questions, to highlight resilience.`
        },
        {
            id: 'yellow-grief-loss',
            title: 'Grief and Loss',
            category: 'Yellow Zone',
            emoji: 'ğŸŸ¨',
            color: 'yellow',
            tags: ['grief', 'bereavement', 'loss', 'sadness', 'yellow'],
            content: `### Validate the Pain\n"Grief is such a profound and painful experience. There's no timeline for it, and no 'right' way to do it. Whatever you're feeling right nowâ€”sadness, anger, numbness, confusionâ€”it's all a valid part of the process. It's the price of love, in a way."\n\n### Permission to Grieve\n"You have permission to feel exactly what you're feeling. You don't need to put on a brave face or rush through this for anyone's sake, including your own. It's okay to not be okay."\n\n### Focus on Self-Care and Gentleness\n"When you're grieving, your whole system is under immense stress. What's one small, gentle thing you could do for yourself today? It doesn't have to be big. Maybe it's just drinking a glass of water, or stretching for 30 seconds."\n\n### Intervention Insight\n* Practice the **Self-Compassion Break (Kristin Neff)** to offer kindness to the part that is hurting.\n* Use **Values Clarification & Committed Action** to connect with what still matters, even in the midst of pain.`
        },
        {
            id: 'yellow-social-anxiety',
            title: 'Social or Performance Anxiety',
            category: 'Yellow Zone',
            emoji: 'ğŸŸ¨',
            color: 'yellow',
            tags: ['social anxiety', 'performance anxiety', 'fear', 'avoidance', 'yellow'],
            content: `### Normalize the Fear\n"It makes perfect sense to feel anxious in social situations, especially when you feel like you're being judged. That's a very common fear. Your brain is just trying to protect you from potential rejection, which is a deep, primal fear for humans."\n\n### Externalize the Anxiety\n"Let's think of that anxiety as a characterâ€”like a worried bodyguard that's a little too overprotective. It means well, but its advice isn't always helpful. We can say, 'Thanks for trying to protect me, Anxiety, but I've got this.'" \n\n### Focus on Small, Value-Based Steps\n"Instead of focusing on conquering the fear, what if we focused on a value, like 'connection' or 'courage'? What is one tiny step you could take that aligns with that value, even if the anxiety is still there? Maybe it's just making eye contact with the cashier for one second."\n\n### Intervention Insight\n* Use **ACT Defusion: Distancing from Thoughts** to unhook from anxious predictions.\n* Practice **Thought Challenging - cognitive restructuring** on specific fears like "Everyone will think I'm stupid."`
        },
        {
            id: 'yellow-terminal-illness',
            title: 'Terminal Illness',
            category: 'Yellow Zone',
            emoji: 'ğŸŸ¨',
            color: 'yellow',
            tags: ['illness', 'grief', 'mortality', 'existential', 'yellow'],
            content: `### Initial Response & Presence\n"Thank you for reaching out today. I can only imagine how overwhelming this must be for you right now. Having a terminal diagnosis brings up so many intense feelings and fears. I'm here with you in this moment, and I want you to know that whatever you're feeling right now is completely valid and understandable."\n\n### Validating the Enormity of Their Experience\n"What you're going through - facing your own mortality - this is one of the most profound and difficult human experiences. There's no right way to feel about this. Whether you're feeling scared, angry, sad, numb, or all of these at once, it all makes sense."\n\n### Self-Compassion in the Face of Mortality\n"Facing terminal illness can bring up so much self-judgment. You deserve infinite compassion right now, especially from yourself. Let's try a **Self-Compassion Break (Kristin Neff)**."\n\n### Meaning-Making and Values Clarification\n"When we're facing limited time, it can help to get clear about what matters most. If you think about the time you have, what do you most want that time to include? How do you want to spend your energy? What relationships matter most? We can use **Values Clarification & Committed Action** to explore this."`
        },
        {
            id: 'yellow-ocd-thoughts',
            title: 'Obsessive-Compulsive Thoughts',
            category: 'Yellow Zone',
            emoji: 'ğŸŸ¨',
            color: 'yellow',
            tags: ['ocd', 'obsessions', 'compulsions', 'intrusive thoughts', 'yellow'],
            content: `### Normalize\nâ€œIt sounds like your brain is stuck on a loop right now. Those kinds of intrusive thoughts can be really exhausting and frightening. Youâ€™re not crazy â€“ OCD-type thoughts happen to a lot of people, and they donâ€™t reflect your character or true intentions.â€\n\n### Plan for Therapy Work\nâ€œIt might help to tell your therapist or psychiatrist about this if you havenâ€™t â€“ OCD is something that can really improve with the right techniques (like Exposure and Response Prevention therapy or sometimes medication).â€\n\n### Intervention Insight\n* Practice **ACT Defusion: Distancing from Thoughts** or **Name the Urge, Challenge the Urge** to create distance.\n* Explain **Radical Acceptance** of the presence of the thought, without accepting its content as true.`
        },
        {
            id: 'yellow-negative-loops',
            title: 'Negative Thought Loops / Rumination',
            category: 'Yellow Zone',
            emoji: 'ğŸŸ¨',
            color: 'yellow',
            tags: ['rumination', 'negative thinking', 'worry', 'anxiety', 'yellow'],
            content: `### Gently Interrupt\nâ€œI notice your mind keeps circling around this. Itâ€™s like youâ€™re stuck in a thought loop, huh? That can be really draining. Letâ€™s hit the pause button on those thoughts for just a moment, if we can.â€\n\n### Intervention Insight\n* Use **ACT Defusion: Distancing from Thoughts** techniques to help distance from thoughts.\n* Try **Grounding Through Senses (5-4-3-2-1 Technique)** to pull attention out of the head and into the environment.`
        },
        {
            id: 'yellow-eating-disorder',
            title: 'Eating Disorder (Moderate)',
            category: 'Yellow Zone',
            emoji: 'ğŸŸ¨',
            color: 'yellow',
            tags: ['eating disorder', 'body image', 'food', 'anorexia', 'bulimia', 'yellow'],
            content: `### Address Gently\nâ€œYou mentioned some concerns around eating and body image. I know that can be really sensitive to talk about. I just want to say: Iâ€™m here to support you, not judge you. A lot of people struggle with food and eating; youâ€™re definitely not alone in that.â€\n\n### Assurance\nâ€œI know this is scary. But youâ€™re not alone in it. We care about you â€“ I care about you â€“ and we want you healthy and happy. You deserve to nourish yourself and to live without this burden.â€\n\n### Intervention Insight\n* Explore the function of the behavior using **Acknowledging an Emotional Part** (e.g., "What is the part of you that restricts/purges trying to achieve for you?").\n* Practice **Opposite Action in Micro** when urges arise.`
        },
        {
            id: 'yellow-neurodivergent',
            title: 'Neurodivergent Challenges (ADHD/Autism Spectrum)',
            category: 'Yellow Zone',
            emoji: 'ğŸŸ¨',
            color: 'yellow',
            tags: ['adhd', 'autism', 'neurodivergent', 'focus', 'sensory', 'yellow'],
            content: `### Immediate Coping for Sensory Overload\nâ€œAre the lights or sounds bothering you right now? We can dim the lights, or if you want, you can wear headphones or a hoodie to feel more comfortable. No judgment â€“ do what you need to regulate.â€\n\n### Encourage Self-Acceptance\nâ€œI know you sometimes feel like youâ€™re â€˜too weirdâ€™ or â€˜brokenâ€™ because of how your brain works. Youâ€™re not. Youâ€™re different, yes, and different can be hard, but it can also be powerful.â€\n\n### Intervention Insight\n* Use **Structured Goal-Setting (e.g., SMART Goals)** to break down overwhelming tasks.\n* Practice **Self-Compassion Break (Kristin Neff)** to counter negative self-talk.`
        },
        {
            id: 'yellow-off-topic',
            title: 'Off-Topic / Distractible',
            category: 'Yellow Zone',
            emoji: 'ğŸŸ¨',
            color: 'yellow',
            tags: ['focus', 'distraction', 'adhd', 'avoidance', 'yellow'],
            content: `### Kindly Refocus\nâ€œI notice we jumped to a different topic just now. Thatâ€™s okay â€“ sometimes our brains steer us away when we hit something uncomfortable or just because something else pops up. Letâ€™s gently steer back to what we were talking about earlier, because I think that was important.â€\n\n### Positive Reinforcement\nâ€œYouâ€™re doing great. We covered the tough bit about your momâ€™s comment after all, and I really appreciate you sticking with that. I know itâ€™s tempting to veer away, but you stayed with it. Thatâ€™s progress!â€`
        },
        {
            id: 'yellow-infidelity',
            title: 'Infidelity',
            category: 'Yellow Zone',
            emoji: 'ğŸŸ¨',
            color: 'yellow',
            tags: ['infidelity', 'betrayal', 'relationships', 'trust', 'yellow'],
            content: `### Immediate Stabilization & Grounding\n"What you've discovered is a major shock to your system. Your body and mind are probably feeling like they're in crisis mode right now. That's completely normal when our world gets turned upside down like this."\n\n### Validating the Crisis Response\n"What you're feeling right now - the shock, the anger, the hurt - all of that makes complete sense. Discovering infidelity is a form of trauma. Your reaction is normal and valid."\n\n### Self-Compassion in Crisis\n"Right now, there might be a voice in your head blaming you. That self-blame is common, but it's not helpful and it's not accurate. Let's try a **Self-Compassion Break (Kristin Neff)**."\n\n### Immediate vs. Long-term Decisions\n"You might be feeling pressure to make big decisions right now. But you're in crisis mode, and that isn't the best time for life-changing decisions. Your only job right now is to take care of yourself through this crisis."`
        },
        // --- GREEN ZONE ---
        {
            id: 'green-imposter-syndrome',
            title: 'Imposter Syndrome',
            category: 'Green Zone',
            emoji: 'ğŸ’š',
            color: 'green',
            tags: ['imposter syndrome', 'self-doubt', 'perfectionism', 'anxiety', 'green'],
            content: `### Normalize the Feeling\n"That feeling of being a 'fraud' or that you're going to be 'found out' is incredibly common, especially among high-achieving people. It's called Imposter Syndrome, and it doesn't mean you're actually an imposter. It means you have a pattern of thinking that discounts your own success."\n\n### Separate Feelings from Facts\n"Let's try an experiment. We have the *feeling* that you don't belong or aren't good enough. Now let's look for the *facts*. What are some objective accomplishments you've had? What positive feedback have you received? The feeling is real, but it might not be telling the whole truth."\n\n### Reframe the Narrative\n"What if this feeling of self-doubt isn't proof of your inadequacy, but a sign that you're pushing yourself, learning, and growing? People who are truly incompetent rarely worry about being incompetent. This feeling often shows up when you're challenging yourself, which is a good thing."\n\n### Intervention Insight\n* Use **Thought Challenging - cognitive restructuring** to directly confront the "imposter" thoughts.\n* Practice **Cognitive Reframing: Behavior vs. Identity** to see successes as part of your story, not just flukes.`
        },
        {
            id: 'green-global-anxiety',
            title: 'Political/Global Events Anxiety',
            category: 'Green Zone',
            emoji: 'ğŸ’š',
            color: 'green',
            tags: ['anxiety', 'global events', 'politics', 'eco-anxiety', 'control', 'green'],
            content: `### Validate\nâ€œIt makes complete sense that youâ€™re feeling [anxious/angry/overwhelmed] given whatâ€™s happening in the world. These are heavy and uncertain times, and your feelings are a very understandable response.â€\n\n### Focus on Control vs. Concern\nâ€œOne thing that can help is to separate what you can control from what you canâ€™t. We canâ€™t single-handedly solve [the big issue] overnight, but we can control some actions in our own lives or communities.â€\n\n### Intervention Insight\n* Use **Circles of Control, Influence, and Concern** to focus energy effectively.\n* Practice **Radical Acceptance** of the things outside of your control.`
        },
        {
            id: 'green-existential',
            title: 'Existential Concerns',
            category: 'Green Zone',
            emoji: 'ğŸ’š',
            color: 'green',
            tags: ['existential', 'meaning', 'purpose', 'mortality', 'green'],
            content: `### Admire Depth and Acknowledge Pain\nâ€œThese are some of the biggest, most profound questions we face as human beings â€“ meaning, purpose, our place in the world. It makes sense that they feel heavy and even overwhelming. Not everyone has the courage to even voice these thoughts.â€\n\n### Explore Values and Sources of Meaning\nâ€œWhen you think about â€˜meaningâ€™ or â€˜purpose,â€™ are there any moments or activities in your life that even briefly give you a sense of meaning? It could be as simple as moments in nature, helping a friend, creating something, learning something new.â€\n\n### Intervention Insight\n* Use **Values Clarification & Committed Action** to build a life aligned with what matters to the client, regardless of cosmic purpose.\n* Use **ACT Defusion: Distancing from Thoughts** to unhook from thoughts of meaninglessness.`
        },
        {
            id: 'green-chronic-pain',
            title: 'Chronic Pain or Health Challenges',
            category: 'Green Zone',
            emoji: 'ğŸ’š',
            color: 'green',
            tags: ['chronic pain', 'illness', 'health', 'coping', 'green'],
            content: `### Acknowledge Difficulty\nâ€œDealing with chronic pain (or a chronic illness) is really tough. Not only are you physically hurting, but it wears on you emotionally too. Itâ€™s completely valid to feel frustrated, exhausted, or down about it.â€\n\n### Discuss Coping Strategies\nâ€œWhat helps on the days when the pain or symptoms are a bit more manageable? Is there anything â€“ maybe a heating pad, a short walk, a certain stretch, a distraction like a good TV show â€“ that gives you even a small relief or comfort?â€\n\n### Intervention Insight\n* Practice **Radical Acceptance** of the current reality of the pain, which is different from approving of it.\n* Use **Mindful Self-Compassion: Soothing Touch** to offer comfort to the body.`
        },
        {
            id: 'green-expressing-needs',
            title: 'Struggling to Identify or Express Needs',
            category: 'Green Zone',
            emoji: 'ğŸ’š',
            color: 'green',
            tags: ['needs', 'communication', 'assertiveness', 'boundaries', 'green'],
            content: `### Highlight the Pattern\nâ€œIt sounds like you often find yourself feeling unsatisfied or hurt because your needs arenâ€™t met â€“ but at the same time, you have a hard time even knowing or saying what those needs are. Thatâ€™s more common than you might think... your needs matter.â€\n\n### Practice in the Moment\nâ€œLetâ€™s practice right now in a small way: How are you feeling in this moment with me? Do you need anything? This is a low-stakes environment to practice identifying a need and voicing it.â€\n\n### Intervention Insight\n* Use the **Nonviolent Communication (NVC) Framework** (Observations, Feelings, Needs, Requests).\n* Use **DEAR MAN: For Interpersonal Effectiveness** to structure a request.`
        },
        {
            id: 'green-enmeshed-relationships',
            title: 'Enmeshed or Dependent Relationships',
            category: 'Green Zone',
            emoji: 'ğŸ’š',
            color: 'green',
            tags: ['enmeshment', 'dependency', 'boundaries', 'identity', 'relationships', 'green'],
            content: `### Validate Difficulty\nâ€œIt sounds like you feel really tangled up in this relationship â€“ like your feelings and decisions are almost merged with theirs. That can be comforting at times, but also suffocating or confusing.â€\n\n### Identify Personal Values and Interests\nâ€œLetâ€™s talk about you â€“ just you. What are some things you enjoy or value that are independent of this other person? It could be hobbies, goals, even opinions on things like favorite movies or foods.â€\n\n### Intervention Insight\n* Explore **Boundary Setting Exploration & Practice**.\n* Use **Values Clarification & Committed Action** to strengthen sense of self.`
        },
        {
            id: 'green-feeling-stuck',
            title: 'Feeling Directionless or â€œStuckâ€ in Life',
            category: 'Green Zone',
            emoji: 'ğŸ’š',
            color: 'green',
            tags: ['stuck', 'directionless', 'purpose', 'motivation', 'values', 'green'],
            content: `### Normalize\nâ€œA lot of people go through periods of life where they feel lost or directionless. It can be really unsettling, like youâ€™re drifting without a map. First off, itâ€™s okay to not have everything figured out.â€\n\n### Explore Values\nâ€œSometimes direction becomes clearer when we focus on what we truly value in life.â€\n\n### Intervention Insight\n* Use **Solution-Focused Brief Therapy (SFBT) Techniques** like the "Miracle Question" to identify desired future states.\n* Use **Values Clarification & Committed Action** to find a meaningful direction.`
        },
        {
            id: 'green-time-management',
            title: 'Time Management and Organization',
            category: 'Green Zone',
            emoji: 'ğŸ’š',
            color: 'green',
            tags: ['time management', 'organization', 'procrastination', 'productivity', 'green'],
            content: `### Positive Frame\nâ€œYouâ€™re looking to get more organized and manage your time better â€“ thatâ€™s a great goal. These skills can make life so much less stressful once they click, and Iâ€™m excited to help you with it.â€\n\n### Task Chunking\nâ€œAnother approach is breaking the task into teeny tiny chunks. Instead of â€˜Write essay,â€™ chunk it to: â€˜1) Open a Word doc, 2) write a rough title, 3) jot three bullet points of ideas.â€™ Then do one chunk at a time.â€\n\n### Time Management Techniques (Pomodoro)\nâ€œHave you heard of the Pomodoro Technique? Itâ€™s where you work for 25 minutes, then take a 5-minute break, then repeat.â€\n\n### Intervention Insight\n* Encourage **Structured Goal-Setting (e.g., SMART Goals)**.\n* Use **Behavioral Activation** to schedule and commit to tasks.`
        },
        {
            id: 'green-decision-making',
            title: 'Decision-Making',
            category: 'Green Zone',
            emoji: 'ğŸ’š',
            color: 'green',
            tags: ['decisions', 'indecisive', 'anxiety', 'choices', 'green'],
            content: `### Frame the Issue\nâ€œDecision-making can be really stressful, especially if youâ€™re afraid of making the wrong choice or if youâ€™ve got a lot of options. Itâ€™s actually great that you want to work on this; being more confident in your decisions can reduce a lot of anxiety.â€\n\n### Listen to Gut and Head\nâ€œItâ€™s good to analyze, but also consider your gut feeling. Our instincts are basically our subconscious pulling from past experiences and values.â€\n\n### Intervention Insight\n* Use **Structured Problem-Solving** or the **Pros and Cons / Decisional Balance** to examine consequences.\n* Connect the decision to **Values Clarification & Committed Action**.`
        },
        {
            id: 'green-perfectionism',
            title: 'Perfectionism',
            category: 'Green Zone',
            emoji: 'ğŸ’š',
            color: 'green',
            tags: ['perfectionism', 'procrastination', 'self-criticism', 'anxiety', 'green'],
            content: `### Acknowledge Upside/Downside\nâ€œIt sounds like you have some perfectionistic tendencies... On one hand, that drive can push you to achieve great things. On the other hand, itâ€™s really exhausting and can make you avoid things.â€\n\n### Address Procrastination\nâ€œTry the motto, â€˜Done is better than perfect.â€™ Starting something, even if you know itâ€™s rough, gives you material to refine.â€\n\n### Self-Compassion Practice\nâ€œYou likely speak to yourself very harshly when youâ€™re not perfect. Try to cultivate a more compassionate inner voice. A good trick is to talk to yourself as if you were your best friend.â€\n\n### Intervention Insight\n* Use **Thought Challenging - cognitive restructuring** to examine "shoulds".\n* Practice **Opposite Action in Micro** by intentionally submitting "good enough" work.`
        },
        {
            id: 'green-life-transitions',
            title: 'Life Transitions',
            category: 'Green Zone',
            emoji: 'ğŸ’š',
            color: 'green',
            tags: ['transition', 'change', 'graduation', 'new job', 'anxiety', 'green'],
            content: `### Normalize Anxiety\nâ€œBig changes â€“ even positive ones â€“ can be really unsettling. Itâ€™s totally normal to feel anxious or unsure when youâ€™re entering a new phase of life. Youâ€™re basically stepping into the unknown.â€\n\n### Use Old Skills in New Ways\nâ€œRemember that even though the context is changing, youâ€™re bringing all your accumulated skills and wisdom with you. Think about other transitions youâ€™ve navigated in the past... What helped you then?â€\n\n### Build a Support System\nâ€œIn times of change, leaning on support is key. Stay connected with your old friends/colleagues even as you make new ones. Talk to people whoâ€™ve been through similar transitions.â€`
        },
        {
            id: 'green-healthy-habits',
            title: 'Building Healthy Habits & Routines',
            category: 'Green Zone',
            emoji: 'ğŸ’š',
            color: 'green',
            tags: ['habits', 'routines', 'goals', 'motivation', 'green'],
            content: `### Praise Initiative\nâ€œItâ€™s fantastic that you want to build healthy habits. Thatâ€™s a big step toward improving your day-to-day life. Habits and routines can really give you a sense of stability and make those positive actions almost automatic.â€\n\n### Start Small\nâ€œInstead of aiming for 30 minutes of meditation, what if you started with just one deep breath after you sit down at your desk? The goal is to make it so easy you canâ€™t say no.â€\n\n### Accountability\nâ€œIt can really help to track your habits â€“ like a habit journal or an app where you tick off each day you did the behavior. Seeing a streak can be motivating (you wonâ€™t want to break the chain!).â€\n\n### Intervention Insight\n* Use **Behavioral Activation** to link activities to improved mood.\n* Use **Structured Goal-Setting (e.g., SMART Goals)** to create clear and achievable habits.`
        },
    ];

    const interventionsData = [
        {
            id: 'intervention-tipp',
            title: 'TIPP Skill for Rapid Distress Reduction',
            category: 'Intervention',
            subCategory: 'Distress Tolerance & Emotional Regulation',
            color: 'blue',
            tags: ['dbt', 'distress tolerance', 'regulation', 'panic', 'overwhelm'],
            content: `### Core Rationale\nTIPP skills directly target the body's acute stress response, changing your body chemistry and creating a window to re-engage your thinking brain.\n\n### T - Temperature\n"First, let's try to change your body temperature. The idea is to create a sudden shift. If you can, go splash some cold water on your face - really let it cover your cheeks and the area under your eyes. This can help slow your heart rate down very quickly when you're agitated."\n\n### I - Intense Exercise\n"If you're feeling a lot of restless, built-up energy, a very short burst of exercise can help. Could you do some jumping jacks, run in place as fast as you can, or even just tense and release all your big muscle groups very hard and fast?"\n\n### P - Paced Breathing\n"Now, let's focus on slowing your breath. We're going to make your exhale longer than your inhale. Try breathing in deeply through your nose for 4 seconds, and then breathe out very slowly and gently through your mouth for 6 seconds."\n\n### P - Paired Muscle Relaxation\n"As you continue breathing slowly, when you breathe in, tense a group of muscles. Let's try that with your hands and arms; inhale through your nose, make tight fists. Hold that tension. Now as you exhale, slowly release the squeeze. Notice the difference."\n\n### Clinical Considerations\n* **When to Use:** Best for acute, physiological distress (panic, extreme agitation, intense urges).\n* **When to Avoid:** May not be suitable for individuals with certain medical conditions (e.g., heart problems, breathing issues). Always check for medical contraindications.`
        },
        {
            id: 'intervention-accepts',
            title: 'ACCEPTS: For Distress Tolerance (Distraction)',
            category: 'Intervention',
            subCategory: 'Distress Tolerance & Emotional Regulation',
            color: 'blue',
            tags: ['dbt', 'distress tolerance', 'distraction', 'coping'],
            content: `### Core Rationale\nAn acronym for skills used to tolerate and survive moments of high distress without making things worse, especially when you can't solve the problem right now.\n\n* **A**ctivities: Do something that is healthy and absorbing.\n* **C**ontributing: Do something helpful or kind for someone else.\n* **C**omparisons: Compare yourself to a time you felt worse, or to others struggling.\n* **E**motions: Generate different emotions by watching a comedy, etc.\n* **P**ushing Away: Temporarily push away painful thoughts.\n* **T**houghts: Occupy your mind with other thoughts (counting, etc.).\n* **S**ensations: Use intense, non-harmful sensations to shift focus (cold shower, etc.).`
        },
        {
            id: 'intervention-check-the-facts',
            title: 'Check the Facts (DBT)',
            category: 'Intervention',
            subCategory: 'Distress Tolerance & Emotional Regulation',
            color: 'blue',
            tags: ['dbt', 'emotion regulation', 'thoughts', 'reality testing'],
            content: `### Core Rationale\nA skill to determine if an emotional reaction is justified by the facts of a situation. If the emotion doesn't fit the facts, it opens the door to using Opposite Action.\n\n### How to Practice\n1.  **What is the emotion I want to change?** (e.g., Anger, Fear, Sadness)\n2.  **What is the event prompting my emotion?** Describe the facts of what happened, without interpretations. (e.g., "My friend didn't text me back today.")\n3.  **What are my interpretations, thoughts, and assumptions about the event?** (e.g., "They must be mad at me. I did something wrong.")\n4.  **Am I assuming a threat?** What is the threat? How probable is it that the threat is real?\n5.  **What's the catastrophe?** What is the worst-case scenario here?\n6.  **Does my emotion (and its intensity) fit the actual facts?** (e.g., "Is intense anger justified just because a text wasn't returned? Probably not. Maybe they are just busy.")`
        },
        {
            id: 'intervention-radical-acceptance',
            title: 'Radical Acceptance',
            category: 'Intervention',
            subCategory: 'Core DBT Skills',
            color: 'blue',
            tags: ['dbt', 'acceptance', 'suffering', 'reality'],
            content: `### Core Rationale\nAccepting reality as it is, without judgment, approval, or bitterness. It is about letting go of the fight against what you cannot change to reduce suffering.\n\n### How to Practice\n1.  **Acknowledge Reality:** Notice when you are fighting reality ("This shouldn't be happening!").\n2.  **State the Facts:** Remind yourself, "This is what happened. I cannot change it."\n3.  **Accept with Body & Mind:** Allow yourself to feel the disappointment or sadness, without letting it turn into bitterness or anger at reality itself.\n4.  **Focus on What's Next:** Ask, "Given that this is the reality, what is the wise thing for me to do now?"`
        },
        {
            id: 'intervention-name-urge-challenge-urge',
            title: 'Name the Urge, Challenge the Urge',
            category: 'Intervention',
            subCategory: 'Core DBT Skills',
            color: 'blue',
            tags: ['dbt', 'urges', 'coping', 'self-control'],
            content: `### Core Rationale\nA skill to create distance from an intense urge by first identifying it and then exploring alternative actions.\n\n### How to Practice\n1. **Name the Urge:** "When you feel a really strong urge, like an intense desire to [client's specific urge], the first step can be just to name it. Silently to yourself, or out loud with me, can you say, 'There's the urge to [specific urge]'?"\n2. **Get Curious:** "Okay, now that we've named it... let's get curious about it for a second, without judgment and without immediately acting on it."\n3. **Challenge the Urge:** "Ask yourself... If I don't follow this urge right now, what's one small thing I could do instead? What would be a more helpful choice?"`
        },
        {
            id: 'intervention-opposite-action',
            title: 'Opposite Action in Micro',
            category: 'Intervention',
            subCategory: 'Core DBT Skills',
            color: 'blue',
            tags: ['dbt', 'emotions', 'action urge', 'behavior change'],
            content: `### Core Rationale\nActing opposite to what an unhelpful emotion is urging you to do, especially when the emotion doesn't fit the facts or isn't helpful. This stops feeding the unhelpful emotion.\n\n### How to Practice\n1.  **Identify the Emotion:** What are you feeling? (e.g., Fear, Sadness, Anger).\n2.  **Identify the Action Urge:** What does this emotion make you want to do? (e.g., Avoid, Withdraw, Attack).\n3.  **Ask: Is this Emotion Justified/Helpful?** Does the intensity fit the facts? Will acting on this urge help you in the long run? (Use **Check the Facts (DBT)** here).\n4.  **Do the Opposite (in Micro):** If the emotion is not justified or helpful, act opposite to the urge in a very small way. (e.g., If you feel like shutting down, wiggle your fingers. If you feel like avoiding, look at a picture of what you're avoiding for 5 seconds).`
        },
        {
            id: 'intervention-dear-man',
            title: 'DEAR MAN: For Interpersonal Effectiveness',
            category: 'Intervention',
            subCategory: 'Core DBT Skills',
            color: 'blue',
            tags: ['dbt', 'communication', 'assertiveness', 'boundaries', 'needs'],
            content: `### Core Rationale\nA structured way to ask for something you want or to say "no" effectively and assertively.\n\n### D - Describe\n"Just the facts. What is the specific, objective situation? (e.g., 'The last three times we planned to meet, you cancelled on the day.')"\n\n### E - Express\n"Clearly state your feelings using 'I-statements'. (e.g., 'I feel frustrated and a bit hurt when this happens.')"\n\n### A - Assert\n"Clearly state what you need or want. Be direct. (e.g., 'I would like us to find a way to make our plans more reliable...')"\n\n### R - Reinforce\n"Explain the positive outcome if your request is met. (e.g., 'It would help me feel more secure in our friendship...')"\n\n### M - (Stay) Mindful\n"Keep your focus on your goal. Avoid getting sidetracked."\n\n### A - Appear Confident\n"Use a confident tone and body language, even if you feel nervous."\n\n### N - Negotiate\n"Be willing to listen and find a workable compromise, but don't give up on your core need."\n\n### Clinical Considerations\n* For situations where maintaining the relationship is the primary goal (vs. getting your objective), consider the **GIVE** skill: be **G**entle, act **I**nterested, **V**alidate, and use an **E**asy manner.`
        },
        {
            id: 'intervention-ifs-parts',
            title: 'Acknowledging an Emotional Part',
            category: 'Intervention',
            subCategory: 'Internal Family Systems (IFS) Informed',
            color: 'blue',
            tags: ['ifs', 'parts work', 'internal family systems', 'self-compassion'],
            content: `### Core Rationale\nThe Internal Family Systems (IFS) model suggests our minds are made up of multiple "parts," each with its own feelings and roles. Recognizing these as "parts" helps create distance and allows for a compassionate, curious relationship with our inner world.\n\n### How to Practice\n1.  **Identify the Part:** "It sounds like there's a part of you that feels very [angry/scared]. Can we get curious about it?"\n2.  **Locate it in the Body:** "Where do you feel that part in your body?"\n3.  **Ask it Questions:** "What does this part want you to know? What is it afraid would happen if it didn't feel/act this way?"\n4.  **Offer Understanding:** "How do you (from your calm, compassionate self) feel towards this part? Can we offer it some understanding?"`
        },
        {
            id: 'intervention-somatic-anchors',
            title: 'Simple Somatic Anchors',
            category: 'Intervention',
            subCategory: 'Somatic & Grounding',
            color: 'blue',
            tags: ['somatic', 'grounding', 'body', 'anxiety', 'dissociation'],
            content: `### Core Rationale\nImmediate ways to connect with the present moment using bodily sensations. These anchors signal safety to the nervous system and pull your attention out of overwhelming internal states.\n\n* **Noticing Feet on Floor:** "Just bring your attention down to your feet. Can you feel them on the floor? Notice the sensation of contact."\n* **Butterfly Tapping:** "Cross your arms over your chest, with hands on opposite shoulders. Start gently tapping your hands, one after the other, in a slow, rhythmic way."\n* **Hand on Heart:** "If it feels comfortable, you might try placing a hand gently on your heart. Just notice the warmth and gentle pressure."\n* **Pressing Fingertips Together:** "Try gently pressing the tips of your fingers on one hand against the tips of your fingers on the other. Just notice the sensation."`
        },
        {
            id: 'intervention-54321',
            title: 'Grounding Through Senses (5-4-3-2-1 Technique)',
            category: 'Intervention',
            subCategory: 'Somatic & Grounding',
            color: 'blue',
            tags: ['grounding', 'anxiety', 'panic', 'senses', 'mindfulness'],
            content: `### Core Rationale\nAnchoring in the present by noticing things through all five senses. This pulls your focus out of anxious thoughts and into your immediate, safe environment.\n\n### How to Practice\n"Letâ€™s walk through your senses to ground you in the here and now."\n\n* **5 THINGS YOU CAN SEE:** Look around and name five things you see. (e.g., "I see a lamp, a blue pen, a window...")\n* **4 THINGS YOU CAN FEEL:** Notice four things you can feel with your body. (e.g., "I feel the chair under me, my feet on the floor...")\n* **3 THINGS YOU CAN HEAR:** Listen carefully and name three sounds. (e.g., "I hear the fan, a car outside...")\n* **2 THINGS YOU CAN SMELL:** Notice two scents. (e.g., "I can smell coffee, the soap on my hands...")\n* **1 THING YOU CAN TASTE:** Name one thing you can taste. (e.g., "I can taste my toothpaste," or just notice the taste in your mouth).`
        },
        {
            id: 'intervention-dropping-anchor',
            title: 'Dropping Anchor (ACT)',
            category: 'Intervention',
            subCategory: 'Somatic & Grounding',
            color: 'blue',
            tags: ['act', 'grounding', 'mindfulness', 'anxiety', 'overwhelm'],
            content: `### Core Rationale\nA comprehensive grounding exercise from ACT to acknowledge internal chaos while deliberately re-engaging with the physical world.\n\n### How to Practice (ACE)\n"Let's try an exercise called Dropping Anchor. The storm of thoughts and feelings can continue, we're just going to drop an anchor into the present moment."\n\n1.  **A - Acknowledge:** "First, silently and kindly acknowledge what's happening inside you. Notice the thoughts, the feelings, the memories. Just notice them without judgment. 'I'm noticing feelings of anxiety,' or 'I'm noticing my mind is racing.'"\n2.  **C - Come back into your body:** "Now, gently bring your attention to your physical body. You can press your feet into the floor, straighten your back, press your fingertips together, or slowly stretch. Feel your body in the chair, right here, right now."\n3.  **E - Engage with the world:** "Finally, notice what's around you. Look around the room and find five things you can see. Notice two things you can hear. Notice one thing you can smell. Re-engage with where you are."\n\n"The storm might still be there, but your anchor is holding you steady in the present."`
        },
        {
            id: 'intervention-act-defusion',
            title: 'ACT Defusion: Distancing from Thoughts',
            category: 'Intervention',
            subCategory: 'Acceptance and Commitment Therapy (ACT) Informed',
            color: 'blue',
            tags: ['act', 'defusion', 'thoughts', 'mindfulness', 'acceptance'],
            content: `### Core Rationale\nTechniques from Acceptance and Commitment Therapy (ACT) to change the way we relate to thoughts, rather than changing their content, to reduce their power and believability.\n\n* **"I'm having the thought that..."**: "When a difficult thought gets sticky, try adding this phrase at the beginning: 'I'm having the thought that...' So, 'I'm a failure' becomes, 'I'm having the thought that I'm a failure.' Notice if that creates any space."\n* **Thanking Your Mind**: "Acknowledge the thought and then gently thank your mind for offering it up. 'Thanks, mind, for that really interesting thought!'"\n* **Silly Voice / Singing the Thought**: "Try taking a powerful negative thought and saying it repeatedly in a silly voice, or singing it to the tune of 'Happy Birthday,' to strip away its seriousness."`
        },
        {
            id: 'intervention-values-clarification',
            title: 'Values Clarification & Committed Action',
            category: 'Intervention',
            subCategory: 'Acceptance and Commitment Therapy (ACT) Informed',
            color: 'blue',
            tags: ['act', 'values', 'purpose', 'motivation', 'goals'],
            content: `### Core Rationale\nIdentifying core values and exploring small, concrete actions aligned with those values, even when difficult thoughts and feelings are present.\n\n### How to Practice\n1.  **Explore Values:** "When you think about the kind of person you want to be, what qualities are most important? (e.g., Kindness, Courage, Connection, Growth)." \n2.  **Brainstorm Committed Actions:** "Even with all the challenges, what's one small step you could take this week that would move you even 1% closer to living by that value of [Chosen Value]?"\n3.  **Set an Intention:** "Would you be willing to commit to taking that one small step this week?"`
        },
        {
            id: 'intervention-thought-challenging',
            title: 'Thought Challenging - cognitive restructuring',
            category: 'Intervention',
            subCategory: 'Cognitive & Reframing',
            color: 'blue',
            tags: ['cbt', 'thoughts', 'reframing', 'cognitive distortions'],
            content: `### Core Rationale\nExamining the evidence for and against automatic negative thoughts and considering alternative, more balanced perspectives.\n\n### How to Practice\n1.  **Identify the Hot Thought:** "When you felt that strong emotion, what specific thought was going through your mind?"\n2.  **Examine the Evidence For:** "What evidence or experiences make you believe this thought is true?"\n3.  **Examine the Evidence Against:** "Now, let's play detective. What evidence suggests this thought isn't 100% true?"\n4.  **Consider Alternatives:** "If that thought isn't completely true, what's a more balanced or alternative way to think about this situation?"\n5.  **Assess the Impact:** "How does believing the hot thought affect you? How would believing the balanced thought change things?"`
        },
        {
            id: 'intervention-cognitive-reframe-behavior-identity',
            title: 'Cognitive Reframing: Behavior vs. Identity',
            category: 'Intervention',
            subCategory: 'Cognitive & Reframing',
            color: 'blue',
            tags: ['cbt', 'reframing', 'shame', 'identity', 'self-worth'],
            content: `### Core Rationale\nA technique to challenge global, negative self-labels by reframing them as specific, isolated behaviors. This shift separates a person's inherent worth from their actions, making the problem feel more manageable.\n\n### How to Practice\n* **Identify the Identity Statement:** Notice when the client says something like "I am a failure," or "I am a bad person."\n* **Invite the Reframe:** "I hear you saying 'I'm a failure.' Let's try to look at this from a different perspective. Is it more accurate to say 'I made a mistake'? There's a big difference between *being* a failure and *doing* something that didn't work out."\n* **Explore the Impact:** "How does it feel to consider that this was something you *did*, rather than something you *are*?"`
        },
        {
            id: 'intervention-sfbt-techniques',
            title: 'Solution-Focused Brief Therapy (SFBT) Techniques',
            category: 'Intervention',
            subCategory: 'Motivational & Solution-Focused',
            color: 'blue',
            tags: ['sfbt', 'solution focused', 'hope', 'goals', 'future'],
            content: `### Core Rationale\nA future-focused approach that helps clients describe their desired future in detail, bypassing problem-talk and highlighting strengths.\n\n### The Miracle Question\n"Imagine tonight while you're asleep, a miracle happens, and the problem that brought you here is completely solved... When you wake up tomorrow morning, what would be the very first small thing you would notice that would tell you the miracle occurred?"\n\n### Scaling Questions\n"On a scale of 0 to 10, where 10 is the miracle and 0 is the worst it's been, where are you today? ... What keeps you at a [number] instead of a zero? ... What would a [number + 1] look like?"\n\n### Coping Questions\n"Given how difficult things have been, how have you managed to keep going? What have you been doing to prevent things from getting even worse?"`
        },
        {
            id: 'intervention-pros-cons-balance',
            title: 'Pros and Cons / Decisional Balance',
            category: 'Intervention',
            subCategory: 'Motivational & Solution-Focused',
            color: 'blue',
            tags: ['mi', 'motivational interviewing', 'ambivalence', 'decision-making', 'change'],
            content: `### Core Rationale\nA tool to explore ambivalence about making a change by examining the costs and benefits of both changing and staying the same.\n\n### How to Practice\n"It sounds like you're in two minds about this. Let's map that out. We can make a simple four-square grid."\n\n1.  **Pros of Changing:** "What are some of the good things that might happen if you [make the change]?"\n2.  **Cons of Changing:** "What are the downsides or hard parts about [making the change]?"\n3.  **Pros of Staying the Same:** "What's good about things as they are now? What are the benefits of not changing?"\n4.  **Cons of Staying the Same:** "And what are the downsides of things continuing as they are?"\n\n"Looking at all this together, what do you notice? There's no right answer, it's just about seeing the whole picture."`
        },
        {
            id: 'intervention-self-compassion-break',
            title: 'Self-Compassion Break (Kristin Neff)',
            category: 'Intervention',
            subCategory: 'Self-Awareness & Self-Management',
            color: 'blue',
            tags: ['self-compassion', 'mindfulness', 'kindness', 'shame'],
            content: `### Core Rationale\nA brief, structured practice to offer oneself kindness in moments of suffering, based on three core components.\n\n### How to Practice\n1.  **Acknowledge the Pain (Mindfulness):** "Right now, it sounds like you're really going through a hard time. Can we just pause and acknowledge that? 'This is a moment of suffering,' or 'This really hurts.'"\n2.  **Connect to Common Humanity:** "Now, can you remind yourself that suffering and feeling this way is part of being human? 'I'm not alone in feeling this way.'"\n3.  **Offer Self-Kindness:** "And now, if you feel comfortable, maybe place a hand on your heart. Ask yourself, 'What do I need to hear right now?' Try saying something gentle, like 'May I be kind to myself.'"`
        },
        {
            id: 'intervention-mindful-self-compassion-touch',
            title: 'Mindful Self-Compassion: Soothing Touch',
            category: 'Intervention',
            subCategory: 'Self-Awareness & Self-Management',
            color: 'blue',
            tags: ['self-compassion', 'somatic', 'soothing', 'kindness', 'body'],
            content: `### Core Rationale\nUsing physical touch to activate the care system and calm the nervous system. The body often responds to gentle, supportive touch even when the mind is resistant to kind words.\n\n### How to Practice\n"Sometimes words of kindness don't land, but our bodies can still respond to a gesture of care. If you're comfortable, I invite you to try one of these."\n\n* **Hand on Heart:** "You could gently place a hand over your heart. Feel the warmth and gentle pressure. Just notice that sensation."\n* **Gentle Hug:** "You could give yourself a gentle hug, wrapping your arms around yourself."\n* **Cradling Your Face:** "You could gently cup your face in your hands, as you might for a child who is upset."\n* **Stroking Your Arm:** "Gently and slowly stroking your arm can also be very soothing."\n\n"Just take a moment to notice what it feels like to offer this small gesture of kindness to yourself. There's no right or wrong way to feel."`
        },
        {
            id: 'intervention-circles-of-control',
            title: 'Circles of Control, Influence, and Concern',
            category: 'Intervention',
            subCategory: 'Self-Awareness & Self-Management',
            color: 'blue',
            tags: ['control', 'anxiety', 'worry', 'problem solving', 'acceptance'],
            content: `### Core Rationale\nA visual tool to differentiate between what one can control, influence, or only be concerned about, helping to focus energy effectively.\n\n### How to Practice\n"Imagine three concentric circles."\n\n1.  **Inner Circle (Control):** "In the very middle, let's list the things you have direct control over. These are usually your own thoughts, attitudes, choices, actions, and responses."\n2.  **Middle Circle (Influence):** "In the next circle, let's put things you don't control, but you might be able to influence. This could be how others respond to you, or your relationships."\n3.  **Outer Circle (Concern/No Control):** "In the outermost circle, let's list the things that concern you but that you have little to no control over, like other people's choices, past events, or global issues."\n\n"Looking at this map, where are you spending most of your energy? What would it be like to shift more focus onto your Circle of Control?"`
        },
        {
            id: 'intervention-nvc',
            title: 'Nonviolent Communication (NVC) Framework',
            category: 'Intervention',
            subCategory: 'Interpersonal & Communication Skills',
            color: 'blue',
            tags: ['nvc', 'communication', 'needs', 'feelings', 'requests'],
            content: `### Core Rationale\nA communication framework focusing on expressing oneself honestly and receiving others empathically.\n\n### The Four Components\n1. **Observations:** State the concrete facts you are observing, without evaluation or judgment. (e.g., "When I see dirty socks on the floor...")\n2. **Feelings:** State the emotion you are feeling, without thought or story. (e.g., "...I feel irritated...")\n3. **Needs:** State the universal human need that is connected to your feeling. (e.g., "...because I need more order in the rooms we share.")\n4. **Requests:** Make a clear, positive, and concrete request for action. (e.g., "Would you be willing to put your socks in the laundry basket?")`
        },
        {
            id: 'intervention-boundary-setting-exploration',
            title: 'Boundary Setting Exploration & Practice',
            category: 'Intervention',
            subCategory: 'Interpersonal & Communication Skills',
            color: 'blue',
            tags: ['boundaries', 'assertiveness', 'relationships', 'self-respect'],
            content: `### Core Rationale\nUnderstanding what boundaries are, identifying where they might be weak, and practicing communicating them respectfully but firmly.\n\n### Exploration\n* **Connect to Feelings:** "You mentioned feeling [resentful/exhausted]. Often, these feelings can be signals that a boundary might need to be set."\n* **Identify Boundary Types:** "Boundaries can be about different things - our time, our emotions, our physical space, our energy. Where do you feel yours are most often crossed?"\n\n### Practice\n* **Simple 'No' Statements:** "Let's practice some gentle but clear ways to say no. How might it feel to say: 'I need some time to think about that,' or 'Thank you for asking, but I won't be able to do that right now.'"\n* **Acknowledge Guilt/Fear:** "It's common to feel guilty when we first start setting boundaries. That doesn't mean it's wrong to set them."`
        },
        {
            id: 'intervention-assertiveness-training',
            title: 'Assertiveness Skills Training & Practice',
            category: 'Intervention',
            subCategory: 'Interpersonal & Communication Skills',
            color: 'blue',
            tags: ['assertiveness', 'communication', 'i-statements', 'self-respect'],
            content: `### Core Rationale\nUnderstanding the difference between passive, aggressive, and assertive communication, and practicing skills to express needs, opinions, and boundaries clearly and respectfully.\n\n### Key Concepts\n* **Define Assertiveness:** "Assertiveness is about finding the middle ground between being passive (letting others walk over you) and being aggressive (walking over others). It's about expressing your truth respectfully."\n* **'I-Statements' Practice:** "To express a feeling assertively, try using an 'I-statement' like: 'I feel [Your Feeling] when [Objective Situation] because [Your Need].' This owns your feeling without blaming the other person."\n* **'Broken Record' Technique:** "When someone keeps pushing, calmly and clearly repeat your point or boundary. For example, 'I understand, but I won't be able to help with that today.' ... 'I hear you, and my answer is still that I can't help today.'"`
        },
        {
            id: 'intervention-behavioral-activation',
            title: 'Behavioral Activation',
            category: 'Intervention',
            subCategory: 'Practical Life Skills & Goal Achievement',
            color: 'blue',
            tags: ['cbt', 'depression', 'motivation', 'action', 'habits'],
            content: `### Core Rationale\nA core CBT skill for depression that works on an "outside-in" principle: acting in line with your goals and values can improve your mood, even if you don't feel like it at first. It focuses on increasing engagement in positive and rewarding activities.\n\n### How to Practice\n1.  **Identify Activities:** "Let's brainstorm some activities, even very small ones, that you used to enjoy, or that align with a sense of pleasure, mastery, or connection. Don't worry about whether you feel like doing them now."\n2.  **Schedule One Small Thing:** "Instead of waiting for motivation to strike, let's schedule one of these activities into your week as if it were an appointment. The key is to make it very small and achievable. For example, 'Listen to one favorite song' or 'Walk to the end of the driveway and back.'"\n3.  **Track Mood:** "Before and after you do the activity, rate your mood on a scale of 1-10. Often, we see a small lift, even if we didn't expect it."\n4.  **Focus on Action, Not Feeling:** "The goal is just to *do* the thing. The feeling might or might not follow, and that's okay. We're just running the experiment."`
        },
        {
            id: 'intervention-structured-problem-solving',
            title: 'Structured Problem-Solving',
            category: 'Intervention',
            subCategory: 'Practical Life Skills & Goal Achievement',
            color: 'blue',
            tags: ['problem-solving', 'cbt', 'planning', 'decision-making'],
            content: `### Core Rationale\nA step-by-step process to break down overwhelming problems, brainstorm solutions, evaluate them, and create an action plan.\n\n### The Steps\n1. **Define the Problem Clearly:** "Let's state the problem as clearly and specifically as possible."\n2. **Brainstorm All Options (No Judgment):** "Let's list every possible solution we can think of, without judging if they are good or bad yet."\n3. **Evaluate Pros & Cons:** "Now let's look at these options. For each one, what are the potential upsides and downsides?"\n4. **Choose One Step:** "Based on our evaluation, which option feels like the best first step to try?"\n5. **Create an Action Plan:** "What exactly will you do? When will you do it? How will you know you've done it?"\n6. **Plan for Obstacles:** "What might get in the way of taking this step? And if that happens, what's your backup plan?"`
        },
        {
            id: 'intervention-smart-goals',
            title: 'Structured Goal-Setting (e.g., SMART Goals)',
            category: 'Intervention',
            subCategory: 'Practical Life Skills & Goal Achievement',
            color: 'blue',
            tags: ['goals', 'planning', 'motivation', 'smart goals'],
            content: `### Core Rationale\nA framework (Specific, Measurable, Achievable, Relevant, Time-bound) to turn vague ideas into actionable goals.\n\n### The SMART Framework\n* **S**pecific: "Let's get really clear on what you want to accomplish. Instead of 'get healthier,' what specifically does that mean to you?"\n* **M**easurable: "How will you know when you've achieved this goal, or how will you track your progress?"\n* **A**chievable: "Given your current circumstances, does this goal feel realistic and attainable? What might make it more achievable?"\n* **R**elevant: "Why is this goal important to you right now? How does it align with your bigger values?"\n* **T**ime-bound: "What's a realistic timeframe for achieving this goal? When do you want to start?"`
        }
    ];

    const psychoeducationData = [
        {
            id: 'psychoed-window-of-tolerance',
            title: 'The Window of Tolerance',
            category: 'Psychoeducation',
            emoji: 'ğŸ§ ',
            color: 'purple',
            tags: ['regulation', 'arousal', 'nervous system', 'psychoed', 'trauma'],
            content: `### What is the Window of Tolerance?\nImagine your nervous system has a "window" where you feel at your best. Inside this window, you can handle life's ups and downs. You feel calm, connected, and able to think clearly. You're in your "social engagement" system.\n\n### What happens when we leave the window?\nStress, triggers, or trauma can push us outside our window.\n\n* **Hyper-arousal (Above the Window):** This is the "fight or flight" response (sympathetic nervous system). You might feel anxious, overwhelmed, angry, or panicky. Your thoughts might race, and your body feels tense.\n* **Hypo-arousal (Below the Window):** This is the "freeze" or "shut down" response (dorsal vagal). You might feel numb, empty, disconnected, or have trouble thinking. Your body might feel heavy and tired.\n\n### The Goal\nThe goal isn't to never leave the windowâ€”that's impossible. The goal is to first notice when we've left it, and then to use skills to gently guide ourselves back inside. Over time, therapy can help widen the window itself, so you can handle more without getting thrown out of it.\n\n### Intervention Insight\n* When you're hyper-aroused, use skills like the **TIPP Skill for Rapid Distress Reduction** to calm your physiology.\n* When you're hypo-aroused or just want to stay in the window, use skills like **Grounding Through Senses (5-4-3-2-1 Technique)** or **Simple Somatic Anchors**.`
        },
        {
            id: 'psychoed-polyvagal-theory',
            title: 'Polyvagal Theory (Simplified)',
            category: 'Psychoeducation',
            emoji: 'ğŸ§ ',
            color: 'purple',
            tags: ['polyvagal', 'nervous system', 'safety', 'connection', 'psychoed'],
            content: `### The Nervous System's Ladder\nThink of your nervous system as a ladder with three levels, which we move up and down all day long. This is based on Dr. Stephen Porges' Polyvagal Theory.\n\n1.  **Top of the Ladder (Ventral Vagal):** This is your "safe and social" state. When you're here, you feel calm, connected, and curious. You can engage with others, learn, and rest. This is the state we're in when we're inside our **The Window of Tolerance**.\n\n2.  **Middle of the Ladder (Sympathetic):** This is your "mobilized" state of fight-or-flight. When your brain detects a threat, it moves you here. Your heart races, you feel anxious, angry, or panicked. You have energy to deal with the danger.\n\n3.  **Bottom of the Ladder (Dorsal Vagal):** This is your "immobilized" or "shut down" state. If the threat is too big to fight or flee, the system slams on the brakes. You might feel numb, disconnected, hopeless, or frozen. It's a very old survival system.\n\n### Why It Matters\nUnderstanding this helps us be more compassionate with ourselves. Your state isn't a choice; it's your body's automatic response to cues of safety or danger. The goal of many regulation skills is to help your system climb back up the ladder to that "safe and social" state.\n\n### Intervention Insight\n* To move from Sympathetic (anxious) to Ventral Vagal (calm), skills like **TIPP Skill for Rapid Distress Reduction** are effective.\n* To move from Dorsal Vagal (shut down) to Ventral Vagal (calm), gentle grounding like **Simple Somatic Anchors** or **Mindful Self-Compassion: Soothing Touch** can help.`
        },
        {
            id: 'psychoed-cognitive-distortions',
            title: 'Cognitive Distortions (Thought Traps)',
            category: 'Psychoeducation',
            emoji: 'ğŸ§ ',
            color: 'purple',
            tags: ['cbt', 'thoughts', 'distortions', 'reframing', 'psychoed'],
            content: `### What are Cognitive Distortions?\nCognitive distortions are patterns of thinking that are often inaccurate and negatively biased. They are like mental filters that make us see reality in a distorted way. Everyone does them, but they can cause a lot of distress when they become habitual.\n\n### Common Thought Traps:\n* **All-or-Nothing Thinking (Black-and-White Thinking):** Seeing things in absolute, black-and-white categories. If your performance falls short of perfect, you see yourself as a total failure.\n* **Catastrophizing:** Expecting the worst-case scenario to happen, without considering more likely outcomes.\n* **Mind Reading:** Believing you know what others are thinking, usually assuming they are thinking the worst of you.\n* **Fortune Telling:** Predicting the future negatively.\n* **Emotional Reasoning:** Assuming that because you feel something, it must be true. "I feel like an idiot, therefore I must be one."\n* **Overgeneralization:** Seeing a single negative event as a never-ending pattern of defeat.\n* **"Should" Statements:** Criticizing yourself or others with "shoulds," "musts," and "oughts." This can lead to guilt and frustration.\n* **Personalization:** Blaming yourself for something you weren't entirely responsible for.\n\n### What to Do?\nJust noticing these thoughts is the first step. Once you can name the distortion, you can begin to question it.\n\n### Intervention Insight\n* Use **Thought Challenging - cognitive restructuring** to systematically question these distorted thoughts.\n* Use **ACT Defusion: Distancing from Thoughts** to see them as just thoughts, not facts.`
        },
        {
            id: 'psychoed-shame-vs-guilt',
            title: 'Shame vs. Guilt',
            category: 'Psychoeducation',
            emoji: 'ğŸ§ ',
            color: 'purple',
            tags: ['shame', 'guilt', 'self-worth', 'emotions', 'psychoed'],
            content: `### What's the Difference?\nGuilt and shame can feel similar, but they are very different and have different effects on us.\n\n* **Guilt says: "I DID something bad."**\n    * Guilt is focused on a specific *behavior*.
    * It can be helpful because it motivates us to apologize, make amends, and change our behavior in the future.\n    * It's an adaptive emotion.\n\n* **Shame says: "I AM bad."**\n    * Shame is focused on the entire *self*.
    * It's a painful feeling of being flawed and unworthy of connection.\n    * Shame is not helpful. It makes us want to hide, shut down, and disconnect. It often leads to self-destructive behaviors.\n\n### Why it Matters\nLearning to recognize the difference is key. When you feel bad about something, ask yourself: Is this feeling telling me I *did* something wrong (guilt), or that I *am* something wrong (shame)?\n\n### Intervention Insight\n* If it's guilt, we can use **Structured Problem-Solving** to figure out how to make amends.\n* If it's shame, we need to use tools like the **Self-Compassion Break (Kristin Neff)** and **Cognitive Reframing: Behavior vs. Identity** to challenge the feeling of worthlessness.`
        },
        {
            id: 'psychoed-panic-vs-anxiety',
            title: 'Panic Attack vs. Anxiety Attack',
            category: 'Psychoeducation',
            emoji: 'ğŸ§ ',
            color: 'purple',
            tags: ['panic', 'anxiety', 'definitions', 'psychoed'],
            content: `### What's the Difference?\nWhile they feel similar, there are some key differences.\n\n* **Panic Attacks:** These are intense and sudden. They often have no clear trigger and peak within about 10 minutes. The physical symptoms (racing heart, shortness of breath, dizziness) are very strong and can make people feel like they're dying or losing control.\n* **Anxiety Attacks:** "Anxiety attack" isn't an official clinical term, but people use it to describe a period of intense anxiety. It usually builds up over time in response to a specific stressor. It can last much longer than a panic attack, but the physical symptoms might be less severe.\n\n### Why it Matters\nKnowing the difference can help you understand what's happening. A panic attack, while terrifying, is temporary and will pass. Recognizing it as panic can reduce the fear that something is medically wrong.\n\n### Intervention Insight\n* For the intense peak of a panic attack, the **TIPP Skill for Rapid Distress Reduction** is designed to quickly lower physiological arousal.\n* For lingering anxiety, distraction skills like **ACCEPTS: For Distress Tolerance (Distraction)** can be helpful.`
        },
        {
            id: 'psychoed-what-is-dbt',
            title: 'What is DBT?',
            category: 'Psychoeducation',
            emoji: 'ğŸ§ ',
            color: 'purple',
            tags: ['dbt', 'therapy', 'skills', 'psychoed'],
            content: `### What is Dialectical Behavior Therapy (DBT)?\nDBT is a type of therapy designed to help people who experience emotions very intensely. The "Dialectic" part means finding a balance between two things that seem like opposites: **Acceptance** and **Change**.\n\n### The Two Core Ideas\n1.  **Acceptance:** This means accepting yourself and your reality as they are right now, without judgment. Skills like mindfulness and **Radical Acceptance** help with this.\n2.  **Change:** This means working to build a life you want to live by learning new, more effective ways of coping and interacting with others.\n\n### The Four Skill Modules\n* **Mindfulness:** Learning to be present in the moment.\n* **Distress Tolerance:** Learning to get through crisis moments without making things worse. (e.g., **TIPP Skill for Rapid Distress Reduction**)\n* **Emotion Regulation:** Learning to understand and manage your emotions. (e.g., **Check the Facts (DBT)**)\n* **Interpersonal Effectiveness:** Learning to get your needs met in relationships while maintaining self-respect. (e.g., **DEAR MAN: For Interpersonal Effectiveness**)`
        }
    ];

    const scriptsData = [
        {
            id: 'script-boundary-setting',
            title: 'Foundational Boundary Setting',
            category: 'Script',
            color: 'indigo',
            tags: ['boundaries', 'role setting', 'containment', 'scripts'],
            content: `### Standard Framing\nâ€œBefore we get startedâ€”my role isnâ€™t for processing, but to make sure youâ€™re safe and help get you grounded so you can rejoin group. Weâ€™ve got about 20 minutes, can you tell me whatâ€™s going on that brought you to reach out for support?â€\n\n### For Clients Expecting Therapy\nâ€œMy roleâ€™s a bit different than a therapistâ€™sâ€”Iâ€™m not here to fully process, but I am here to check in on your safety and help you feel a little more steady before heading back to group. Want to tell me whatâ€™s weighing on you today?â€\n\n### Quick Boundary Phrases\n* "I canâ€™t go deep with you here, but I can help you feel safer and more grounded right now."\n* "Letâ€™s slow it down together. Iâ€™m here to help steady thingsâ€”not unpack everything."`
        },
        {
            id: 'script-stabilize',
            title: 'Stabilization Scripts',
            category: 'Script',
            color: 'indigo',
            tags: ['stabilize', 'grounding', 'containment', 'validation', 'scripts'],
            content: `### Validate & Contain\nâ€œYouâ€™ve been dealing with a lot, and your mind and body are hitting a limit. Thatâ€™s okay. Thereâ€™s no rush to fix anything right now. Weâ€™re not trying to erase that heaviness â€” but to hold it in a way that feels manageable enough for this moment."\n\n### Slow Nervous System\nâ€œLetâ€™s take a moment to slow things down together. Thereâ€™s no rush here and no pressure to fix anything. Let's try one slow breath together. Inhale and notice your lungs filling... hold it for a second... now exhale nice and slow."\n\n### Empower & Redirect\nâ€œYour courage in acknowledging how intense this feels is really powerful. Remember, our goal isnâ€™t to solve everything right now â€” itâ€™s just to get you steady enough that you can leave here feeling a bit more centered.â€`
        },
        {
            id: 'script-end-of-session',
            title: 'End-of-Session Scripts',
            category: 'Script',
            color: 'indigo',
            tags: ['end of session', 'survey', 'closure', 'scripts'],
            content: `### Survey\nâ€œBefore you go back to group, I do have a brief survey that Iâ€™m required to provide. It's very short, just a thumbs up or thumbs down. Do you see the link in the chat?â€\nâ€œGreat! Let me know when you are done and then I will get you back into group.â€\n\n### If Still Heavy\n"Youâ€™re still carrying a lot â€” I see that. We havenâ€™t solved everything, and weâ€™re not supposed to in these few minutes. I just want to make sure that what youâ€™re feeling now is something you can handle for now. Does it feel safe enough for you to wrap up, even if itâ€™s still heavy?"\n\n### If Still in Distress\n"I donâ€™t want to send you back in this state. Why donâ€™t we take another minute here? We can try another grounding technique or even get additional support if you need it. My priority is that you leave feeling safe enough. How are you feeling about continuing a bit longer until this eases?"`
        },
        {
            id: 'script-trauma-dumping-containment',
            title: 'Trauma-Dumping Containment Scripts',
            category: 'Script',
            color: 'indigo',
            tags: ['trauma', 'containment', 'boundaries', 'safety', 'scripts'],
            content: `### Mid-Session Redirect\nâ€œI really hear that this is painful, and it makes sense that youâ€™d want to process it. But because we only have a few minutes and Iâ€™m not in the role of a therapist, I want to be careful we donâ€™t go too deep here and leave you feeling more overwhelmed.â€\n\n### Gentle Wall for Immediate Flooding\nâ€œI know it can feel urgent to get it all out, but my role is to support you in feeling safeâ€”not to unpack everything. If we open something deep in this short space, thereâ€™s a chance youâ€™ll end up carrying it alone after we disconnectâ€”and I want to avoid that.â€\n\n### Emergency Stop â€“ Already Flooded\nâ€œYouâ€™ve shared something really heavy, and I can tell this matters. But weâ€™re in a short space right now, and going deeper might actually make things harder for you when I have to end the session. Letâ€™s focus on helping you stabilize.â€`
        },
    ];
    
    const scratchpadTemplates = {
        safetyPlan: `### Safety Plan\n\n**Warning Signs (Thoughts, feelings, behaviors that things are getting worse):**\n- \n\n**Internal Coping Strategies (Things I can do on my own):**\n- \n\n**Social Distractions (People or places that can distract me):**\n- \n\n**People I Can Ask for Help:**\n- \n\n**Professional Resources (Therapist, crisis lines):**\n- \n\n**Making My Environment Safe:**\n- `,
        sessionNotes: () => {
            const now = new Date();
            const timestamp = now.toLocaleString('en-US', {
                dateStyle: 'short',
                timeStyle: 'short'
            });
            return `(${timestamp})\n\n[Concern] CC request for Ct ___.\n[Intervention] CSSRS: ___. Ct ___.\n[Outcome] Ct returned to group.`;
        }
    };

    // ---- STATE AND DATA ----
    const state = {
        favorites: [],
        recentlyViewed: [],
        usedThisSession: [],
        contentMap: new Map(),
        interventionMap: new Map(),
        annotations: {},
        currentView: 'dashboard',
        currentOpenScenario: null,
        scratchpadContent: '',
        scratchpadMode: 'write', 
        timer: {
            intervalId: null,
            elapsedSeconds: 0,
            isPaused: true,
        },
        isEditingQuickAccess: false,
        quickAccessIds: [],
    };

    const colorMap = {
        red: { border: "border-red-500", bg: "bg-red-50 dark:bg-red-900/20", text: "text-red-600 dark:text-red-400" },
        orange: { border: "border-orange-500", bg: "bg-orange-50 dark:bg-orange-900/20", text: "text-orange-600 dark:text-orange-400" },
        yellow: { border: "border-yellow-500", bg: "bg-yellow-50 dark:bg-yellow-900/20", text: "text-yellow-600 dark:text-yellow-400" },
        green: { border: "border-green-500", bg: "bg-green-50 dark:bg-green-900/20", text: "text-green-600 dark:text-green-400" },
        blue: { border: "border-blue-500", bg: "bg-blue-50 dark:bg-blue-900/20", text: "text-blue-600 dark:text-blue-400" },
        indigo: { border: "border-indigo-500", bg: "bg-indigo-50 dark:bg-indigo-900/20", text: "text-indigo-600 dark:text-indigo-400" },
        purple: { border: "border-purple-500", bg: "bg-purple-50 dark:bg-purple-900/20", text: "text-purple-600 dark:text-purple-400" },
    };

    // ---- DOM REFERENCES ----
    const dom = {
        contentArea: document.getElementById('content-area'),
        searchBox: document.getElementById('search-box'),
        toast: document.getElementById('toast'),
        scenarioModal: document.getElementById('scenario-modal'),
        modalContentWrapper: document.getElementById('modal-content-wrapper'),
        modalTitle: document.getElementById('modal-title'),
        modalBody: document.getElementById('modal-body'),
        modalContext: document.getElementById('modal-context'),
        closeModal: document.getElementById('close-modal'),
        modalPrev: document.getElementById('modal-prev'),
        modalNext: document.getElementById('modal-next'),
        usedThisSessionContainer: document.getElementById('used-this-session-container'),
        themeToggle: document.getElementById('theme-toggle'),
        copyModalContentBtn: document.getElementById('copy-modal-content-to-scratchpad'),
        addAnnotationBtn: document.getElementById('add-annotation-btn'),
        confirmationModal: document.getElementById('confirmation-modal'),
        confirmationTitle: document.getElementById('confirmation-title'),
        confirmationMessage: document.getElementById('confirmation-message'),
        confirmationConfirm: document.getElementById('confirmation-confirm'),
        confirmationCancel: document.getElementById('confirmation-cancel'),
        sessionTimer: document.getElementById('session-timer'),
        sessionTimerContainer: document.getElementById('session-timer-container'),
        timerToggleBtn: document.getElementById('timer-toggle-btn'),
        timerResetBtn: document.getElementById('timer-reset-btn'),
        quickAccessModal: document.getElementById('quick-access-modal'),
        quickAccessList: document.getElementById('quick-access-list'),
        quickAccessSearch: document.getElementById('quick-access-search'),
        closeQuickAccessModal: document.getElementById('close-quick-access-modal'),
        annotationModal: document.getElementById('annotation-modal'),
        annotationModalTitle: document.getElementById('annotation-modal-title'),
        annotationTextarea: document.getElementById('annotation-textarea'),
        annotationSave: document.getElementById('annotation-save'),
        annotationCancel: document.getElementById('annotation-cancel'),
        floatingScratchpadModal: document.getElementById('floating-scratchpad-modal'),
        floatingScratchpadBody: document.getElementById('floating-scratchpad-body'),
        closeScratchpadBtn: document.getElementById('close-scratchpad-btn'),
        scratchpadToggleBtn: document.getElementById('scratchpad-toggle-btn'),
    };

    // ---- STATE PERSISTENCE ----
    function saveState() {
        localStorage.setItem('clinicalFavorites', JSON.stringify(state.favorites));
        localStorage.setItem('clinicalRecents', JSON.stringify(state.recentlyViewed));
        localStorage.setItem('clinicalScratchpad', state.scratchpadContent);
        localStorage.setItem('clinicalQuickAccess', JSON.stringify(state.quickAccessIds));
        localStorage.setItem('clinicalAnnotations', JSON.stringify(state.annotations));
    }

    function loadState() {
        state.favorites = JSON.parse(localStorage.getItem('clinicalFavorites') || '[]');
        state.recentlyViewed = JSON.parse(localStorage.getItem('clinicalRecents') || '[]');
        state.scratchpadContent = localStorage.getItem('clinicalScratchpad') || '';
        const savedQuickAccess = localStorage.getItem('clinicalQuickAccess');
        state.quickAccessIds = savedQuickAccess ? JSON.parse(savedQuickAccess) : ['script-boundary-setting', 'intervention-tipp', 'intervention-self-compassion-break', 'script-end-of-session'];
        state.annotations = JSON.parse(localStorage.getItem('clinicalAnnotations') || '{}');
    }

    // ---- INITIALIZATION ----
    function initializeDataMap() {
        const allContent = [...clinicalData, ...interventionsData, ...scriptsData, ...psychoeducationData];
        allContent.forEach(item => state.contentMap.set(item.id, item));
        
        interventionsData.forEach(item => {
            state.interventionMap.set(item.title, item.id);
            item.referencedIn = []; // Initialize for bi-directional linking
        });

        buildInterventionLinks();
    }

    function buildInterventionLinks() {
        const contentToScan = [...clinicalData, ...psychoeducationData, ...interventionsData];
        
        contentToScan.forEach(sourceItem => {
            if (!sourceItem.content) return;

            state.interventionMap.forEach((interventionId, interventionTitle) => {
                // Use a word boundary \b to avoid matching partial words
                const regex = new RegExp(`\\*\\*(${interventionTitle})\\*\\*`, 'g');
                if (sourceItem.content.match(regex)) {
                    const targetIntervention = state.contentMap.get(interventionId);
                    if (targetIntervention && !targetIntervention.referencedIn.includes(sourceItem.id)) {
                        targetIntervention.referencedIn.push(sourceItem.id);
                    }
                }
            });
        });
    }

    // ---- RENDERING ----
    function createScenarioCard(scenario) {
        const isFavorite = state.favorites.includes(scenario.id);
        const colors = colorMap[scenario.color] || colorMap.indigo;
        const tagsHtml = (scenario.tags || []).slice(0, 3).map(tag => 
            `<button class="tag-btn text-xs font-medium mr-1.5 mb-1.5 px-2.5 py-0.5 rounded-full bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" data-tag="${tag}">${tag}</button>`
        ).join('');

        return `
        <div class="scenario-card bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 flex flex-col border-l-4 ${colors.border}">
            <div class="p-4 flex-1 flex flex-col">
                <h3 class="font-bold text-gray-800 dark:text-gray-100 flex items-center">
                    <span class="mr-2">${scenario.emoji || ''}</span>
                    <span class="flex-1">${scenario.title}</span>
                </h3>
                <div class="mt-3 text-xs text-gray-500 dark:text-gray-400 flex-1 flex flex-wrap items-start">
                    ${tagsHtml}
                </div>
                <div class="mt-4 flex justify-between items-center">
                    <button class="view-btn text-sm font-semibold text-indigo-600 dark:text-indigo-400 hover:underline" data-id="${scenario.id}">View Details</button>
                    <button class="favorite-btn p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700" data-id="${scenario.id}" title="Add to favorites">
                        <i data-lucide="star" class="w-5 h-5 ${isFavorite ? 'text-yellow-500 fill-current' : 'text-gray-400'}"></i>
                    </button>
                </div>
            </div>
        </div>
        `;
    }

    function renderCardList(container, items, message, search_query = '') {
        container.style.opacity = '0';
        setTimeout(() => {
            let headerHtml = '';
            if(search_query){
                headerHtml = `<div class="col-span-full mb-4 flex items-center gap-4">
                    <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-300">Showing ${items.length} results for "${search_query}"</h2>
                    <button id="clear-search-btn" class="text-sm text-indigo-600 dark:text-indigo-400 hover:underline">Clear</button>
                </div>`;
            }
            
            container.innerHTML = headerHtml + '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>';
            const grid = container.querySelector('.grid');

            if (items.length === 0) {
                grid.innerHTML = `<div class="col-span-full text-center text-gray-500 py-12">${message}</div>`;
            } else {
                grid.innerHTML = items.map(createScenarioCard).join('');
            }
            lucide.createIcons();
            container.style.opacity = '1';
        }, 300);
    }

    function renderDashboard() {
        dom.contentArea.style.opacity = '0';
        setTimeout(() => {
            const zones = ['Red Zone', 'Orange Zone', 'Yellow Zone', 'Green Zone'];
            const zoneEmojis = {'Red Zone': 'ğŸ”´', 'Orange Zone': 'ğŸŸ ', 'Yellow Zone': 'ğŸŸ¨', 'Green Zone': 'ğŸ’š'};
            
            const quickAccessItems = state.quickAccessIds.map(id => state.contentMap.get(id)).filter(Boolean);

            let editControls = '';
            if (state.isEditingQuickAccess) {
                editControls = `
                    <button id="done-quick-access-btn" class="text-sm font-semibold text-green-600 dark:text-green-400 hover:underline">Done</button>
                `;
            } else {
                editControls = `<button id="edit-quick-access-btn" class="text-sm font-semibold text-indigo-600 dark:text-indigo-400 hover:underline">Edit</button>`;
            }

            let quickAccessHtml = `
                <div class="mb-10">
                    <div class="flex justify-between items-center mb-4 pb-2 border-b-2 border-gray-300 dark:border-gray-600">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <i data-lucide="zap" class="w-6 h-6 text-gray-500"></i> Quick Access
                        </h2>
                        ${editControls}
                    </div>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                        ${quickAccessItems.map(item => `
                            <div class="relative">
                                <button class="view-btn p-4 bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-all text-left flex flex-col justify-between h-full w-full border-l-4 ${colorMap[item.color]?.border || ''}" data-id="${item.id}">
                                    <span class="font-semibold text-gray-800 dark:text-gray-200">${item.title}</span>
                                    <span class="text-xs mt-2 ${colorMap[item.color]?.text || ''}">${item.category}</span>
                                </button>
                                ${state.isEditingQuickAccess ? `<button class="remove-quick-access-btn absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600" data-id="${item.id}"><i data-lucide="x" class="w-3 h-3"></i></button>` : ''}
                            </div>
                        `).join('')}
                        ${state.isEditingQuickAccess ? `
                            <button id="add-quick-access-card" class="p-4 bg-gray-100 dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center justify-center border-2 border-dashed border-gray-400 dark:border-gray-600 text-gray-500 hover:text-indigo-500 hover:border-indigo-500">
                                <i data-lucide="plus" class="w-8 h-8"></i>
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;

            let zonesHtml = zones.map(zone => {
                const itemsInZone = clinicalData.filter(item => item.category === zone);
                if (itemsInZone.length === 0) return '';
                const zoneColor = itemsInZone[0].color;
                return `
                    <div class="mb-10">
                        <h2 class="text-2xl font-bold mb-4 pb-2 border-b-2 border-${zoneColor}-500 text-${zoneColor}-600 dark:text-${zoneColor}-400">${zoneEmojis[zone]} ${zone}</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                            ${itemsInZone.map(createScenarioCard).join('')}
                        </div>
                    </div>
                `;
            }).join('');

            dom.contentArea.innerHTML = quickAccessHtml + zonesHtml;
            lucide.createIcons();
            dom.contentArea.style.opacity = '1';
        }, 300);
    }
    
    function renderQuickAccessAddModal(searchTerm = '') {
        const allItems = Array.from(state.contentMap.values()).sort((a, b) => a.title.localeCompare(b.title));
        const filteredItems = allItems.filter(item => 
            !state.quickAccessIds.includes(item.id) &&
            item.title.toLowerCase().includes(searchTerm.toLowerCase())
        );

        if (filteredItems.length === 0) {
            dom.quickAccessList.innerHTML = `<p class="text-center text-gray-500">No items found or all are added.</p>`;
            return;
        }

        dom.quickAccessList.innerHTML = filteredItems.map(item => {
            const colors = colorMap[item.color] || colorMap.indigo;
            return `
                <div class="flex items-center p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                    <div class="flex-1">
                        <p class="font-semibold text-gray-800 dark:text-gray-100">${item.title}</p>
                        <p class="text-xs ${colors.text}">${item.category}</p>
                    </div>
                    <button class="add-quick-access-item-btn p-2 bg-green-500 text-white rounded-full hover:bg-green-600" data-id="${item.id}">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                    </button>
                </div>
            `;
        }).join('');
        lucide.createIcons();
    }

    function openQuickAccessModal() {
        renderQuickAccessAddModal();
        dom.quickAccessModal.classList.remove('modal-hidden');
        dom.quickAccessModal.classList.add('modal-visible');
        setTimeout(() => {
            dom.quickAccessModal.querySelector('.modal-content').classList.remove('opacity-0', 'scale-95');
        }, 10);
    }

    function closeQuickAccessModal() {
        dom.quickAccessModal.querySelector('.modal-content').classList.add('opacity-0', 'scale-95');
        setTimeout(() => {
            dom.quickAccessModal.classList.add('modal-hidden');
            dom.quickAccessModal.classList.remove('modal-visible');
        }, 300);
    }

    function renderCategorizedList(container, items, categoryTitle, message) {
        container.style.opacity = '0';
        setTimeout(() => {
            const grouped = items.reduce((acc, item) => {
                const group = item.subCategory || 'General';
                if (!acc[group]) {
                    acc[group] = [];
                }
                acc[group].push(item);
                return acc;
            }, {});

            let html = `<h1 class="text-3xl font-bold mb-8">${categoryTitle}</h1>`;
            
            if (Object.keys(grouped).length === 0) {
                html += `<div class="text-center text-gray-500 py-12">${message}</div>`;
            } else {
                const sortedGroupNames = Object.keys(grouped).sort();
                for (const groupName of sortedGroupNames) {
                    html += `
                        <div class="mb-10">
                            <h2 class="text-xl font-bold mb-4 pb-2 border-b-2 border-gray-300 dark:border-gray-600">${groupName}</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                                ${grouped[groupName].map(createScenarioCard).join('')}
                            </div>
                        </div>
                    `;
                }
            }
            container.innerHTML = html;
            lucide.createIcons();
            container.style.opacity = '1';
        }, 300);
    }

    function renderUsedThisSession() {
        if (state.usedThisSession.length === 0) {
            dom.usedThisSessionContainer.innerHTML = '';
            return;
        }
        const itemsHtml = state.usedThisSession.map(id => {
            const item = state.contentMap.get(id);
            if (!item) return '';
            return `
                <button class="view-btn inline-flex items-center gap-x-1.5 py-1.5 px-3 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-800/30 dark:text-blue-400 hover:bg-blue-200 dark:hover:bg-blue-700" data-id="${id}">
                    <span>${item.title}</span>
                    <button class="remove-used-btn group -mr-1.5" data-id="${id}">
                        <i data-lucide="x" class="w-3 h-3 text-blue-500 group-hover:text-blue-700 dark:group-hover:text-blue-200"></i>
                    </button>
                </button>
            `;
        }).join('');

        dom.usedThisSessionContainer.innerHTML = `
            <div class="p-4 rounded-lg bg-gray-100 dark:bg-gray-800">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-sm font-semibold text-gray-600 dark:text-gray-400">Used This Session:</h3>
                    <button id="copy-used-log-btn" class="flex items-center text-xs px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600">
                        <i data-lucide="copy" class="w-3 h-3 mr-1"></i>Copy Log
                    </button>
                </div>
                <div class="flex flex-wrap gap-2">${itemsHtml}</div>
            </div>
        `;
        lucide.createIcons();
    }
    
    function renderFloatingScratchpad() {
        dom.floatingScratchpadBody.innerHTML = `
            <div class="flex items-center gap-2 mb-4">
                <button id="toggle-scratchpad-mode" class="text-sm px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600">
                    ${state.scratchpadMode === 'write' ? 'Preview' : 'Edit'}
                </button>
                <button class="template-item text-sm px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600" data-template="sessionNotes">Note</button>
                <button class="template-item text-sm px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600" data-template="safetyPlan">Safety Plan</button>
                <button id="clear-scratchpad" class="ml-auto text-sm text-red-500 hover:underline">Clear</button>
            </div>
            <div id="scratchpad-write-area" class="${state.scratchpadMode === 'write' ? '' : 'hidden'}">
                <textarea id="scratchpad-textarea"
                    class="w-full p-4 border border-gray-300 dark:bg-gray-700 dark:border-gray-600 rounded-lg scratchpad-resize text-sm font-mono focus:ring-2 focus:ring-teal-500 focus:outline-none"
                    rows="12"
                    placeholder="Type notes, scripts, or plans here... (Markdown supported)">${state.scratchpadContent || ''}</textarea>
                <div class="flex mt-3 gap-2">
                    <button id="copy-scratchpad" class="flex items-center text-xs px-3 py-1 bg-indigo-100 dark:bg-indigo-900 rounded-md text-indigo-700 dark:text-indigo-200 hover:bg-indigo-200 dark:hover:bg-indigo-800"><i data-lucide="copy" class="w-4 h-4 mr-1"></i>Copy</button>
                    <button id="download-scratchpad" class="flex items-center text-xs px-3 py-1 bg-green-100 dark:bg-green-900 rounded-md text-green-700 dark:text-green-200 hover:bg-green-200 dark:hover:bg-green-800"><i data-lucide="download" class="w-4 h-4 mr-1"></i>Download</button>
                </div>
            </div>
            <div id="scratchpad-preview-area" class="prose dark:prose-invert max-w-none ${state.scratchpadMode === 'preview' ? '' : 'hidden'} p-4 border border-dashed border-gray-300 dark:border-gray-600 rounded-lg min-h-[12rem] bg-gray-50 dark:bg-gray-900/50">
                ${marked.parse(state.scratchpadContent || '_Nothing here yet. Type in Edit mode!_')}
            </div>
        `;
        lucide.createIcons();
        attachScratchpadEvents();
    }

    function openModal(scenarioId, searchQuery = '') {
        const scenario = state.contentMap.get(scenarioId);
        if (!scenario) return;

        state.currentOpenScenario = scenario;
        
        const categoryColor = colorMap[scenario.color] || colorMap.indigo;
        const contextTags = (scenario.tags || []).map(tag => `<button class="tag-btn text-xs font-medium px-2 py-0.5 rounded-full bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors" data-tag="${tag}">${tag}</button>`).join('');
        dom.modalContext.innerHTML = `<span class="text-xs font-semibold px-2 py-0.5 rounded-full ${categoryColor.bg} ${categoryColor.text}">${scenario.category}</span>` + contextTags;

        dom.modalTitle.innerHTML = `<span class="mr-3">${scenario.emoji || ''}</span> ${scenario.title}`;
        
        let processedContent = scenario.content;
        state.interventionMap.forEach((id, title) => {
            const regex = new RegExp(`\\*\\*(${title})\\*\\*`, 'g');
            processedContent = processedContent.replace(regex, `<button class="insight-link" data-id="${id}">$1</button>`);
        });

        if (scenario.referencedIn?.length > 0) {
            const referencesHtml = scenario.referencedIn.map(id => {
                const refScenario = state.contentMap.get(id);
                if (!refScenario) return '';
                return `<li><button class="insight-link" data-id="${id}">${refScenario.title}</button></li>`;
            }).join('');
            processedContent += `\n\n### Commonly Used For / Related To:\n<ul>${referencesHtml}</ul>`;
        }
        
        const annotation = state.annotations[scenario.id];
        if (annotation) {
            processedContent += `\n\n<div class="p-4 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg not-prose"><h4 class="text-sm font-bold text-yellow-800 dark:text-yellow-200 !mt-0">My Note:</h4><div class="prose prose-sm dark:prose-invert max-w-none">${marked.parse(annotation)}</div></div>`;
        }

        dom.modalBody.innerHTML = marked.parse(processedContent);
        
        if (searchQuery) {
            highlightText(dom.modalBody, searchQuery);
        }
        
        makeChecklistsInteractive(dom.modalBody);
        makeSectionsCollapsible(dom.modalBody);
        
        dom.scenarioModal.classList.remove('modal-hidden');
        dom.scenarioModal.classList.add('modal-visible');
        setTimeout(() => {
            dom.modalContentWrapper.classList.remove('opacity-0', 'scale-95');
        }, 10);

        if (!state.usedThisSession.includes(scenarioId)) {
            state.usedThisSession.push(scenarioId);
            renderUsedThisSession();
        }
        if (!state.recentlyViewed.includes(scenarioId)) {
            state.recentlyViewed = [scenarioId, ...state.recentlyViewed.filter(id => id !== scenarioId)].slice(0, 20);
            saveState();
        }
        
        updateModalNav();
        lucide.createIcons();
    }
    
    function makeChecklistsInteractive(container) {
        const lists = container.querySelectorAll('ol');
        lists.forEach(list => {
            list.classList.add('interactive-checklist');
            const items = list.querySelectorAll('li');
            items.forEach((item, index) => {
                const originalText = item.innerHTML;
                const checkboxId = `checklist-${state.currentOpenScenario.id}-${index}`;
                item.innerHTML = `
                    <label for="${checkboxId}">
                        <input type="checkbox" id="${checkboxId}">
                        <span class="checkbox-custom"></span>
                        <span class="checkbox-text">${originalText}</span>
                    </label>
                `;
            });
        });
    }

    function makeSectionsCollapsible(container) {
        const headers = container.querySelectorAll('h3');
        headers.forEach(header => {
            header.classList.add('collapsible-header');
            header.innerHTML += `<i data-lucide="chevron-down" class="w-5 h-5"></i>`;

            let content = [];
            let nextElem = header.nextElementSibling;
            while (nextElem && nextElem.tagName !== 'H3') {
                content.push(nextElem);
                nextElem = nextElem.nextElementSibling;
            }

            const contentWrapper = document.createElement('div');
            contentWrapper.classList.add('collapsible-content');
            content.forEach(el => contentWrapper.appendChild(el));
            header.parentNode.insertBefore(contentWrapper, header.nextElementSibling);

            header.addEventListener('click', () => {
                header.classList.toggle('collapsed');
                contentWrapper.classList.toggle('collapsed');
            });
        });
    }
    
    function highlightText(container, text) {
        const walker = document.createTreeWalker(container, NodeFilter.SHOW_TEXT, null, false);
        let node;
        const regex = new RegExp(`(${text})`, 'gi');
        while (node = walker.nextNode()) {
            if (node.parentElement.tagName !== 'MARK') {
                const newHtml = node.textContent.replace(regex, `<mark>$1</mark>`);
                if (newHtml !== node.textContent) {
                    const newNode = document.createElement('span');
                    newNode.innerHTML = newHtml;
                    node.parentNode.replaceChild(newNode, node);
                }
            }
        }
    }

    function closeModal() {
        if (dom.scenarioModal.classList.contains('modal-hidden')) {
            return;
        }
        dom.modalContentWrapper.classList.add('opacity-0', 'scale-95');
        setTimeout(() => {
            dom.scenarioModal.classList.add('modal-hidden');
            dom.scenarioModal.classList.remove('modal-visible');
        }, 300);
    }
    
    function updateModalNav() {
        const currentList = getCurrentList();
        const currentIndex = currentList.findIndex(item => item.id === state.currentOpenScenario.id);
        
        dom.modalPrev.disabled = currentIndex <= 0;
        dom.modalNext.disabled = currentIndex >= currentList.length - 1;

        dom.modalPrev.onclick = () => {
            if (currentIndex > 0) openModal(currentList[currentIndex - 1].id, dom.searchBox.value);
        };
        dom.modalNext.onclick = () => {
            if (currentIndex < currentList.length - 1) openModal(currentList[currentIndex + 1].id, dom.searchBox.value);
        };
    }

    // ---- TIMER LOGIC ----
    function toggleTimer() {
        state.timer.isPaused = !state.timer.isPaused;
        if (state.timer.isPaused) {
            clearInterval(state.timer.intervalId);
            state.timer.intervalId = null;
            dom.timerToggleBtn.innerHTML = `<i data-lucide="play" class="w-4 h-4"></i>`;
        } else {
            if (!state.timer.intervalId) {
                state.timer.intervalId = setInterval(updateTimer, 1000);
            }
            dom.timerToggleBtn.innerHTML = `<i data-lucide="pause" class="w-4 h-4"></i>`;
        }
        lucide.createIcons();
    }

    function resetTimer() {
        clearInterval(state.timer.intervalId);
        state.timer.intervalId = null;
        state.timer.elapsedSeconds = 0;
        state.timer.isPaused = true;
        dom.sessionTimer.textContent = '00:00';
        dom.timerToggleBtn.innerHTML = `<i data-lucide="play" class="w-4 h-4"></i>`;
        lucide.createIcons();
        
        dom.sessionTimerContainer.classList.remove('bg-yellow-100', 'dark:bg-yellow-900', 'bg-red-100', 'dark:bg-red-900');
        dom.sessionTimerContainer.classList.add('bg-green-100', 'dark:bg-green-900');
    }

    function updateTimer() {
        if (state.timer.isPaused) return;
        state.timer.elapsedSeconds++;
        const minutes = Math.floor(state.timer.elapsedSeconds / 60);
        const seconds = state.timer.elapsedSeconds % 60;
        dom.sessionTimer.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        
        dom.sessionTimerContainer.classList.remove('bg-green-100', 'dark:bg-green-900', 'bg-yellow-100', 'dark:bg-yellow-900', 'bg-red-100', 'dark:bg-red-900');
        if (minutes < 10) {
            dom.sessionTimerContainer.classList.add('bg-green-100', 'dark:bg-green-900');
        } else if (minutes < 15) {
            dom.sessionTimerContainer.classList.add('bg-yellow-100', 'dark:bg-yellow-900');
        } else {
            dom.sessionTimerContainer.classList.add('bg-red-100', 'dark:bg-red-900');
        }
    }

    // ---- EVENT HANDLERS & LOGIC ----
    function handleContentInteraction(e) {
        const viewBtn = e.target.closest('.view-btn');
        if (viewBtn) {
            if (e.target.closest('.remove-used-btn') || e.target.closest('.remove-quick-access-btn')) return;
            openModal(viewBtn.dataset.id, dom.searchBox.value);
            return;
        }

        const favoriteBtn = e.target.closest('.favorite-btn');
        if (favoriteBtn) {
            const id = favoriteBtn.dataset.id;
            const isFavorite = state.favorites.includes(id);
            if (isFavorite) {
                state.favorites = state.favorites.filter(favId => favId !== id);
                showToast('Removed from favorites', 'info');
            } else {
                state.favorites.push(id);
                showToast('Added to favorites!', 'success');
            }
            saveState();
            if (state.currentView === 'favorites' || dom.searchBox.value) {
                switchView(state.currentView);
            } else {
                const icon = favoriteBtn.querySelector('i');
                icon.classList.toggle('text-yellow-500', !isFavorite);
                icon.classList.toggle('fill-current', !isFavorite);
                icon.classList.toggle('text-gray-400', isFavorite);
            }
            return;
        }
        
        const removeUsedBtn = e.target.closest('.remove-used-btn');
        if(removeUsedBtn) {
            e.stopPropagation();
            const id = removeUsedBtn.dataset.id;
            state.usedThisSession = state.usedThisSession.filter(usedId => usedId !== id);
            renderUsedThisSession();
            return;
        }

        const tagBtn = e.target.closest('.tag-btn');
        if (tagBtn) {
            const tag = tagBtn.dataset.tag;
            closeModal();
            dom.searchBox.value = tag;
            dom.searchBox.dispatchEvent(new Event('input'));
            return;
        }

        const insightLink = e.target.closest('.insight-link');
        if(insightLink) {
            const id = insightLink.dataset.id;
            dom.modalContentWrapper.classList.add('opacity-0', 'scale-95');
            setTimeout(() => {
                openModal(id);
            }, 150);
            return;
        }
        
        if (e.target.closest('#clear-search-btn')) {
            dom.searchBox.value = '';
            switchView(state.currentView);
            return;
        }
        
        if (e.target.closest('#copy-used-log-btn')) {
            copyUsedLogToScratchpad();
            return;
        }

        // Quick Access Edit Logic
        if (e.target.closest('#edit-quick-access-btn')) {
            state.isEditingQuickAccess = true;
            renderDashboard();
            return;
        }
        if (e.target.closest('#done-quick-access-btn')) {
            state.isEditingQuickAccess = false;
            saveState();
            renderDashboard();
            return;
        }
        if (e.target.closest('.remove-quick-access-btn')) {
            const id = e.target.closest('.remove-quick-access-btn').dataset.id;
            state.quickAccessIds = state.quickAccessIds.filter(qaId => qaId !== id);
            renderDashboard();
            return;
        }
        if (e.target.closest('#add-quick-access-card')) {
            openQuickAccessModal();
            return;
        }
        if (e.target.closest('.add-quick-access-item-btn')) {
            const id = e.target.closest('.add-quick-access-item-btn').dataset.id;
            state.quickAccessIds.push(id);
            renderQuickAccessAddModal(dom.quickAccessSearch.value);
            renderDashboard();
            return;
        }
    }

    function attachScratchpadEvents() {
        const scratchpadBody = dom.floatingScratchpadModal.querySelector('#floating-scratchpad-body');
        if (!scratchpadBody) return;

        scratchpadBody.querySelector('#toggle-scratchpad-mode')?.addEventListener('click', () => {
            state.scratchpadMode = (state.scratchpadMode === 'write') ? 'preview' : 'write';
            renderFloatingScratchpad();
        });
        scratchpadBody.querySelector('#clear-scratchpad')?.addEventListener('click', () => {
            showConfirmationModal('Clear all notes in your scratchpad?', 'This action cannot be undone.', () => {
                state.scratchpadContent = '';
                saveState();
                renderFloatingScratchpad();
                showToast('Scratchpad cleared.', 'success');
            });
        });
        const textarea = scratchpadBody.querySelector('#scratchpad-textarea');
        const previewArea = scratchpadBody.querySelector('#scratchpad-preview-area');
        textarea?.addEventListener('input', (e) => {
            state.scratchpadContent = e.target.value;
            saveState();
            if(previewArea) {
               previewArea.innerHTML = marked.parse(state.scratchpadContent || '_Nothing here yet._');
            }
        });
        scratchpadBody.querySelector('#copy-scratchpad')?.addEventListener('click', () => copyToClipboard(state.scratchpadContent));
        scratchpadBody.querySelector('#download-scratchpad')?.addEventListener('click', downloadScratchpad);
        
        scratchpadBody.querySelectorAll('.template-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const templateKey = e.target.dataset.template;
                let templateContent = scratchpadTemplates[templateKey];
                
                if (typeof templateContent === 'function') {
                    templateContent = templateContent();
                }

                if (templateContent) {
                    const currentText = textarea.value;
                    textarea.value = (currentText ? currentText + '\n\n---\n\n' : '') + templateContent;
                    textarea.dispatchEvent(new Event('input'));
                    textarea.scrollTop = textarea.scrollHeight;
                }
            });
        });
    }
    
    // ---- UTILITIES ----
    function showToast(message, type = 'info') {
        const colors = {
            success: 'bg-green-500',
            info: 'bg-gray-600 dark:bg-gray-700',
            error: 'bg-red-500'
        };
        dom.toast.textContent = message;
        dom.toast.className = `fixed bottom-5 right-5 text-white py-2 px-4 rounded-lg shadow-lg z-[100] transition-all duration-300 ${colors[type]}`;
        dom.toast.classList.remove('hidden');
        dom.toast.classList.add('opacity-100');
        setTimeout(() => { dom.toast.classList.remove('opacity-100'); }, 2700);
        setTimeout(() => { dom.toast.classList.add('hidden'); }, 3000);
    }

    function copyToClipboard(text) {
        if (!text) return;
        const plainText = text.replace(/###\s/g, '').replace(/##\s/g, '').replace(/#\s/g, '').replace(/\*\*/g, '').replace(/\*/g, '').replace(/>\s/g, '');
        const textArea = document.createElement('textarea');
        textArea.value = plainText;
        textArea.style.position = "fixed";
        textArea.style.top = "-9999px";
        document.body.appendChild(textArea);
        textArea.select();
        try {
            document.execCommand('copy');
            showToast("Copied to clipboard!", 'success');
        } catch (err) {
            showToast("Failed to copy.", 'error');
        }
        document.body.removeChild(textArea);
    }
    
    function copyUsedLogToScratchpad() {
        if (state.usedThisSession.length === 0) {
            showToast("Session log is empty.", "info");
            return;
        }
        const logTitle = `### Log from Session (${new Date().toLocaleDateString()})\n\n`;
        const logItems = state.usedThisSession
            .map(id => state.contentMap.get(id)?.title)
            .filter(Boolean)
            .map(title => `- Used: ${title}`)
            .join('\n');
        
        const fullLog = logTitle + logItems;
        state.scratchpadContent += (state.scratchpadContent ? '\n\n---\n\n' : '') + fullLog;
        saveState();
        showToast("Session log copied to scratchpad!", 'success');

        if (!dom.floatingScratchpadModal.classList.contains('modal-hidden')) {
            renderFloatingScratchpad();
        }
    }

    function downloadScratchpad() {
        const blob = new Blob([state.scratchpadContent], { type: 'text/markdown' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'scratchpad.md';
        document.body.appendChild(a);
        a.click();
        setTimeout(() => {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }, 100);
    }
    
    function showConfirmationModal(title, message, onConfirm) {
        dom.confirmationTitle.textContent = title;
        dom.confirmationMessage.textContent = message;
        dom.confirmationModal.classList.remove('modal-hidden');
        dom.confirmationModal.classList.add('modal-visible');
         setTimeout(() => {
            dom.confirmationModal.querySelector('.modal-content').classList.remove('opacity-0', 'scale-95');
        }, 10);
        
        const confirmHandler = () => {
            onConfirm();
            hideConfirmationModal();
        };
        const cancelHandler = () => hideConfirmationModal();

        const hideConfirmationModal = () => {
            dom.confirmationModal.querySelector('.modal-content').classList.add('opacity-0', 'scale-95');
            setTimeout(() => {
                dom.confirmationModal.classList.add('modal-hidden');
                dom.confirmationModal.classList.remove('modal-visible');
                dom.confirmationConfirm.removeEventListener('click', confirmHandler);
                dom.confirmationCancel.removeEventListener('click', cancelHandler);
            }, 300);
        };
        
        dom.confirmationConfirm.addEventListener('click', confirmHandler);
        dom.confirmationCancel.addEventListener('click', cancelHandler);
    }

    function debounce(func, delay) {
        let timeout;
        return function(...args) {
            const context = this;
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(context, args), delay);
        };
    }

    const debouncedSearch = debounce((e) => {
        const q = e.target.value.toLowerCase().trim();
        if (state.currentView === 'scratchpad') return;

        if (!q) {
            switchView(state.currentView);
            return;
        }
        
        const filtered = Array.from(state.contentMap.values()).filter(item =>
            item.title.toLowerCase().includes(q) ||
            (item.content && item.content.toLowerCase().includes(q)) ||
            (item.tags && item.tags.some(tag => tag.toLowerCase().includes(q)))
        );
        renderCardList(dom.contentArea, filtered, 'No matches found for your search.', q);
    }, 300);
    
    // ---- TABS & VIEWS ----
    function getCurrentList() {
        const q = dom.searchBox.value.toLowerCase().trim();
        if (q) {
            return Array.from(state.contentMap.values()).filter(item =>
                item.title.toLowerCase().includes(q) ||
                (item.content && item.content.toLowerCase().includes(q)) ||
                (item.tags && item.tags.some(tag => tag.toLowerCase().includes(q)))
            );
        }

        switch (state.currentView) {
            case 'favorites': return state.favorites.map(id => state.contentMap.get(id)).filter(Boolean);
            case 'recents': return state.recentlyViewed.map(id => state.contentMap.get(id)).filter(Boolean);
            case 'interventions': return interventionsData;
            case 'scripts': return scriptsData;
            case 'psychoeducation': return psychoeducationData;
            case 'dashboard': return clinicalData;
            default: return Array.from(state.contentMap.values());
        }
    }

    function switchView(viewId) {
        state.currentView = viewId;
        // Update sidebar link styles
        document.querySelectorAll('.sidebar-link').forEach(link => {
            const isSelected = link.dataset.tab === viewId;
            link.classList.toggle('bg-indigo-100', isSelected);
            link.classList.toggle('dark:bg-indigo-800', isSelected);
            link.classList.toggle('text-indigo-700', isSelected);
            link.classList.toggle('dark:text-indigo-200', isSelected);
            link.classList.toggle('font-semibold', isSelected);
        });
        dom.scratchpadToggleBtn.classList.remove('bg-indigo-100', 'dark:bg-indigo-800', 'text-indigo-700', 'dark:text-indigo-200', 'font-semibold');
        dom.scratchpadToggleBtn.classList.remove('bg-teal-100', 'dark:bg-teal-900', 'text-teal-700', 'dark:text-teal-200');

        if (dom.searchBox.value) {
            dom.searchBox.value = '';
        }

        if (viewId === 'dashboard') {
            renderDashboard();
        } else if (viewId === 'interventions') {
            renderCategorizedList(dom.contentArea, interventionsData, 'Interventions', 'No interventions found.');
        } else if (viewId === 'psychoeducation') {
            renderCardList(dom.contentArea, psychoeducationData, 'No psychoeducation topics found.');
        } else {
            let items = [];
            let message = 'No items found.';
            if (viewId === 'favorites') {
                items = state.favorites.map(id => state.contentMap.get(id)).filter(Boolean);
                message = 'No favorites yet. Click the star on a card to add one.';
            } else if (viewId === 'recents') {
                items = state.recentlyViewed.map(id => state.contentMap.get(id)).filter(Boolean);
                message = 'No recently viewed items.';
            } else if (viewId === 'scripts') {
                items = scriptsData;
                message = 'No scripts found.';
            }
            renderCardList(dom.contentArea, items, message);
        }
    }

    // ---- THEME ----
    function applyTheme(isDark) {
        document.documentElement.classList.toggle('dark', isDark);
        dom.themeToggle.innerHTML = isDark ? '<i data-lucide="sun" class="w-5 h-5"></i>' : '<i data-lucide="moon" class="w-5 h-5"></i>';
        lucide.createIcons();
    }

    // ---- DRAGGABLE MODAL ----
    function makeDraggable(element, handle) {
        let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
        handle.onmousedown = dragMouseDown;

        function dragMouseDown(e) {
            e = e || window.event;
            e.preventDefault();
            pos3 = e.clientX;
            pos4 = e.clientY;
            document.onmouseup = closeDragElement;
            document.onmousemove = elementDrag;
        }

        function elementDrag(e) {
            e = e || window.event;
            e.preventDefault();
            pos1 = pos3 - e.clientX;
            pos2 = pos4 - e.clientY;
            pos3 = e.clientX;
            pos4 = e.clientY;
            element.style.top = (element.offsetTop - pos2) + "px";
            element.style.left = (element.offsetLeft - pos1) + "px";
        }

        function closeDragElement() {
            document.onmouseup = null;
            document.onmousemove = null;
        }
    }

    // ---- MAIN INITIALIZATION ----
    function main() {
        loadState();
        initializeDataMap();

        // Event listeners
        document.querySelectorAll('.sidebar-link').forEach(link => {
            if (link.id !== 'scratchpad-toggle-btn') {
                link.addEventListener('click', () => switchView(link.dataset.tab));
            }
        });
        document.body.addEventListener('click', handleContentInteraction);
        
        dom.searchBox?.addEventListener('input', debouncedSearch);
        dom.timerToggleBtn?.addEventListener('click', toggleTimer);
        dom.timerResetBtn?.addEventListener('click', resetTimer);
        
        dom.closeModal.addEventListener('click', closeModal);
        dom.closeQuickAccessModal.addEventListener('click', closeQuickAccessModal);
        dom.quickAccessSearch.addEventListener('input', (e) => renderQuickAccessAddModal(e.target.value));
        
        // Click-out listeners
        dom.scenarioModal.addEventListener('click', (e) => { if (e.target === dom.scenarioModal) closeModal(); });
        dom.quickAccessModal.addEventListener('click', (e) => { if (e.target === dom.quickAccessModal) closeQuickAccessModal(); });
        dom.annotationModal.addEventListener('click', (e) => { if (e.target === dom.annotationModal) dom.annotationCancel.click(); });
        dom.confirmationModal.addEventListener('click', (e) => { if (e.target === dom.confirmationModal) dom.confirmationCancel.click(); });

        dom.addAnnotationBtn.addEventListener('click', () => {
            if (state.currentOpenScenario) {
                dom.annotationModalTitle.textContent = `Note for: ${state.currentOpenScenario.title}`;
                dom.annotationTextarea.value = state.annotations[state.currentOpenScenario.id] || '';
                dom.annotationModal.classList.remove('modal-hidden');
                dom.annotationModal.classList.add('modal-visible');
                setTimeout(() => {
                    dom.annotationModal.querySelector('.modal-content').classList.remove('opacity-0', 'scale-95');
                }, 10);
            }
        });

        dom.annotationCancel.addEventListener('click', () => {
            dom.annotationModal.querySelector('.modal-content').classList.add('opacity-0', 'scale-95');
            setTimeout(() => {
                dom.annotationModal.classList.add('modal-hidden');
                dom.annotationModal.classList.remove('modal-visible');
            }, 300);
        });

        dom.annotationSave.addEventListener('click', () => {
            const note = dom.annotationTextarea.value;
            const id = state.currentOpenScenario.id;
            if (note.trim()) {
                state.annotations[id] = note;
            } else {
                delete state.annotations[id];
            }
            saveState();
            showToast("Note saved!", "success");
            dom.annotationCancel.click(); // Close modal
            openModal(id, dom.searchBox.value); // Re-open main modal to show updated note
        });


        dom.themeToggle?.addEventListener('click', () => {
            const isCurrentlyDark = document.documentElement.classList.contains('dark');
            const newIsDark = !isCurrentlyDark;
            localStorage.setItem('theme', newIsDark ? 'dark' : 'light');
            applyTheme(newIsDark);
        });
        dom.copyModalContentBtn.addEventListener('click', () => {
            if (state.currentOpenScenario) {
                const contentToCopy = `### ${state.currentOpenScenario.title}\n\n${state.currentOpenScenario.content}`;
                state.scratchpadContent += (state.scratchpadContent ? '\n\n---\n\n' : '') + contentToCopy;
                saveState();
                showToast('Copied to scratchpad!', 'success');
                if (!dom.floatingScratchpadModal.classList.contains('modal-hidden')) {
                    renderFloatingScratchpad();
                }
            }
        });
        
        // Floating Scratchpad Logic
        dom.scratchpadToggleBtn.addEventListener('click', () => {
            const modal = dom.floatingScratchpadModal;
            const isHidden = modal.classList.contains('modal-hidden');
            if (isHidden) {
                renderFloatingScratchpad();
                modal.classList.remove('modal-hidden');
                modal.classList.add('modal-visible');
                setTimeout(() => {
                    modal.querySelector('.modal-content').classList.remove('opacity-0', 'scale-95');
                }, 10);
            } else {
                modal.querySelector('.modal-content').classList.add('opacity-0', 'scale-95');
                setTimeout(() => {
                    modal.classList.add('modal-hidden');
                    modal.classList.remove('modal-visible');
                }, 300);
            }
        });
        dom.closeScratchpadBtn.addEventListener('click', () => dom.scratchpadToggleBtn.click());
        makeDraggable(dom.floatingScratchpadModal, dom.floatingScratchpadModal.querySelector('.drag-handle'));

        // Initial theme setup
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        applyTheme(savedTheme === 'dark' || (savedTheme === null && prefersDark));

        // Initial view
        switchView(state.currentView || 'dashboard');
        renderUsedThisSession();
        lucide.createIcons();
    }

    document.addEventListener('DOMContentLoaded', main);
    </script>
</body>
</html>
