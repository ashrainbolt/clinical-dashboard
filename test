<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClinicalX: Interactive Dashboard v7.9</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <style>
        :root { --sidebar-width: 260px; }
        body { font-family: 'Inter', sans-serif; background-color: #f9fafb; color: #1f2937; transition: background-color 0.3s, color 0.3s;}
        .dark body { background-color: #111827; color: #d1d5db; }
        .sidebar { width: var(--sidebar-width); }
        .main-content { margin-left: var(--sidebar-width); }
        .sidebar-link { transition: background-color 0.2s, color 0.2s; }
        .sidebar-link.active { background-color: #eef2ff; color: #4338ca; }
        .dark .sidebar-link.active { background-color: #312e81; color: #e0e7ff; }
        .scenario-card { transition: transform 0.2s, box-shadow 0.2s, background-color 0.3s; border-left-width: 4px; }
        .scenario-card:hover { transform: translateY(-4px); box-shadow: 0 7px 14px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);}
        .dark .scenario-card:hover { box-shadow: 0 7px 14px -3px rgba(0,0,0,0.25), 0 4px 6px -2px rgba(0,0,0,0.2);}
        .loader {width: 20px; height: 20px; border: 2px solid #f3f3f3; border-top: 2px solid #4f46e5; border-radius: 50%; animation: spin 1s linear infinite;}
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal-content, .toast-notification { animation: slide-up 0.3s ease-out; }
        @keyframes slide-up { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>
<div class="flex">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar fixed top-0 left-0 h-screen bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 flex flex-col p-4">
        <div class="flex items-center gap-3 mb-8">
            <div class="bg-indigo-600 p-2 rounded-lg">
                <i data-lucide="activity" class="text-white"></i>
            </div>
            <h1 class="text-2xl font-bold text-gray-800 dark:text-white">ClinicalX</h1>
        </div>
        <nav id="sidebar-nav" class="flex-grow space-y-2"></nav>
        <div class="mt-auto">
            <div id="user-id-display" class="text-xs text-center text-gray-400 dark:text-gray-600 mt-1 font-mono">Connecting...</div>
            <div class="flex items-center justify-center space-x-2 mt-4">
                <button id="author-mode-toggle" class="p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700" title="Toggle Author Mode">
                    <i data-lucide="pencil" class="h-5 w-5"></i>
                </button>
                <button id="theme-toggle" class="p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700" title="Toggle Theme">
                    <i data-lucide="sun" id="theme-icon-light" class="h-5 w-5 hidden"></i>
                    <i data-lucide="moon" id="theme-icon-dark" class="h-5 w-5"></i>
                </button>
            </div>
        </div>
    </aside>
    <!-- Main Content -->
    <main class="main-content w-full p-6 md:p-10">
        <div id="content-area" class="mt-8"></div>
    </main>
</div>

<!-- Modals -->
<div id="scenarioModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
    <div class="modal-content bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col">
        <div class="modal-header flex justify-between items-center p-5 border-b border-gray-200 dark:border-gray-700">
            <h3 id="modalTitle" class="text-2xl font-bold flex-1 pr-4"></h3>
            <button id="closeModal" class="text-gray-500 dark:text-gray-400 hover:text-black dark:hover:text-white transition-colors p-2 ml-2" title="Close">
                <i data-lucide="x" class="h-6 w-6"></i>
            </button>
        </div>
        <div id="modalBody" class="modal-body p-6 overflow-y-auto"></div>
    </div>
</div>
<div id="toast" class="hidden fixed bottom-5 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg z-50"></div>

<script type="module">
const clinicalData = {
  red: {
    title: "üî¥ Red Zone ‚Äì Immediate Risk & Crisis",
    color: "red",
    scenarios: [
      {
        id: "suicidal-ideation-assessment",
        title: "Suicidal Ideation ‚Äì Safety Assessment",
        content: `
### ASSESS

"Before we go any deeper, our priority is always your safety. I‚Äôd like to ask a few questions that help us understand how you‚Äôre doing and what kind of support might help keep you safe right now.

1. **Have you wished you were dead or that you could go to sleep and not wake up?**
2. **Have you actually had any thoughts of killing yourself?**
   - Yes, ask questions 3, 4, 5, and 6
   - No, go directly to question 6.
3. **In the past 48 hours, have you been thinking about how you might do this?**
4. **In the past 48 hours, have you had these thoughts and had some intention of acting on them?**
5. **In the past 48 hours, have you started to work out any details for how to kill yourself? Do you intend to carry out this plan?**
6. **In the past 48 hours have you done anything to prepare to end your life?**

**If Yes to 4, 5, or 6:**
Ask scaling questions:

"On a scale of 1-5, one meaning you feel you can stay safe today, and five meaning that you're going to make an attempt today, where would you place yourself right now?"

Reflect back answer and what that means to you:
- "So a four means to me you have a plan and some intentions on acting on the plan, you just don't know when. Is that accurate?"
- "A three means to me you have strong thoughts of wanting to die and have thought about ways you might act on it, but you don't have a specific plan. Did I get that right?"
- "A two means to me that you have fleeting thoughts of wanting to end your life, but no plan or intention of acting on it."

‚ÄúI‚Äôm really glad you told me this. It takes a lot of strength to be this honest, and I‚Äôm here to help you figure it out.‚Äù

---

### SAFETY PLAN

**Need to escalate:**  
‚ÄúThank you for telling me that. If it sounds like things are starting to feel more intense or harder to manage on your own, I‚Äôd like to connect you with a Crisis Manager..."

- **Warning Signs:**  
  ‚ÄúWhat are some early signs you notice when things start to spiral?‚Äù  
- **Internal Coping:**  
  ‚ÄúWhat can you try on your own that sometimes helps, even a little ‚Äî engaging in something creative, putting on funny animal videos or stand-up clips, taking a hot shower, organizing a small space, etc.‚Äù
- **Social Distractions:**  
  ‚ÄúWho or what helps you shift your focus ‚Äî even briefly? A friend, a safe space, a show, a pet?‚Äù
- **People to Reach Out To:**  
  ‚ÄúIf things feel too big to hold alone, who could you reach out to ‚Äî even just to sit with you or check in?‚Äù
- **Professional Resources:**  
  ‚ÄúDo you have Charlie Health‚Äôs 24/7 crisis line saved in your phone?"
- **Safety at Home:**  
  ‚ÄúIs there anything nearby that might feel unsafe to have around right now ‚Äî something we could move, lock up, or ask someone to hold onto for a while?‚Äù
- **Reasons to Stay:**  
  ‚ÄúWhen things get dark, what‚Äôs something ‚Äî or someone ‚Äî that reminds you there‚Äôs still a reason to hang on?‚Äù

---

### Closure & Follow-Up

‚ÄúThank you for staying with this. I know it‚Äôs not easy, and I really appreciate how honest you‚Äôve been.‚Äù

If no immediate risk:
‚ÄúLet‚Äôs make sure your safety plan is saved somewhere easy to find ‚Äî and I‚Äôll send a quick update to your therapist so they‚Äôre looped in and can follow up with you.‚Äù

If escalated to Crisis Manager:
‚ÄúThey‚Äôll take it from here, but I‚Äôll stay until they‚Äôre with you so you‚Äôre not left alone in this.‚Äù
‚ÄúYou‚Äôve done something really important by talking about this instead of holding it in. That shows strength ‚Äî and you don‚Äôt have to go through this alone.‚Äù
        `
      },
      {
        id: "self-harm-urges",
        title: "Self-Harm Urges (Non-Suicidal Self-Injury)",
        content: `
(Client has current or recent urges to self-harm, like cutting or burning, without the intent to die. Focus on reducing emotional overwhelm, finding alternatives, and securing a safety commitment.)

**Direct Check-In**
‚ÄúThank you for telling me. I need to ask: Are you having urges to hurt yourself right now?‚Äù

**If yes (urge is present):**
‚ÄúOn a scale from 1 to 10, how strong is the urge right now, 10 being the strongest?‚Äù
‚ÄúHave you acted on that urge today or recently?‚Äù

**If yes (recent self-harm action):**
‚ÄúWhat did you do, and how severe was it? Do you need any medical attention for that (any injury or bleeding that needs care)?‚Äù

**Clarify Intent**
‚ÄúWhen you self-harmed, was it because you wanted to die, or was it more about coping with pain or numbness?‚Äù

**Validate & Normalize**
‚ÄúIt sounds like everything is feeling really intense right now. I‚Äôm really glad you‚Äôre talking about it instead of keeping it inside or acting on it alone.‚Äù
‚ÄúThat urge makes sense given what you‚Äôre carrying. A part of you is trying to survive and find relief, even if it‚Äôs doing it in a way that ends up hurting you. Let‚Äôs see if we can work with that urge together, rather than against it.‚Äù

**Offer Alternatives & Coping Strategies**
Ask Their Coping: ‚ÄúWhat usually helps even a little when you feel this urge? Maybe we can try one of those things together now.‚Äù
Intense Physical Sensations (TIPP skills): ‚ÄúSometimes our body needs a very strong sensation to release that tension. We could try holding something frozen (like ice), doing a wall-sit or some push-ups, or even snapping a rubber band on your wrist.‚Äù
If they feel numb or disconnected: ‚ÄúIf you‚Äôre feeling really numb, we might try something stimulating: hold a strong scent under your nose (like an essential oil or even vinegar), chew a piece of sour candy, or snap a hair tie on your wrist.‚Äù

**Urge Surfing Technique**
‚ÄúRemember, urges are like waves ‚Äî they build, peak, and eventually fall. Let‚Äôs try to ride this wave out together. You don‚Äôt have to act on it; just notice it rise and fall.‚Äù

**Quick Grounding Distraction**
‚ÄúLet‚Äôs give your brain a short break. Can you name for me five things you see in the room around you that are [pick a color]? (e.g., anything that‚Äôs blue).‚Äù

**Safe Physical Release**
‚ÄúSometimes doing something physical can help release the feeling safely. Would it help to rip up some paper, squeeze a stress ball, stomp your feet, or even scream into a pillow?‚Äù

**Reduce Access to Harm Means**
‚ÄúDo you have anything nearby that you‚Äôve thought about using to hurt yourself? Would it help if we moved those out of reach, just for now, so it‚Äôs a little harder to act on the urge?‚Äù

**Strengthen Support**
‚ÄúWho or what helps you feel a bit more stable when you get like this? Is there a friend or family member you might reach out to after this, or a safe place you can go where you‚Äôre not alone?‚Äù

**Commitment to Safety**
‚ÄúI know the urge is strong, but do you feel like you can stay safe tonight (or until you see your therapist next)? Even if the urge comes back, can you promise me you‚Äôll try these coping steps or reach out before acting on it?‚Äù

**Encourage and Affirm**
‚ÄúI‚Äôm really proud of you for being open about this ‚Äî it takes a lot of courage to face these urges and choose not to give in. Every time you ride the wave or use a tool instead of hurting yourself, you‚Äôre building strength.‚Äù
        `
      },
      // Continue adding other Red Zone scenarios here, each with their full script from CLINICALX.txt
    ]
  },
  // Add Orange, Yellow, Green zones below (see next sections)
};
clinicalData.orange = {
    title: "üü† Orange Zone ‚Äì High Distress",
    color: "orange",
    scenarios: [
      {
        id: "highly-agitated",
        title: "Highly Agitated or Escalating",
        content: `
(Client is extremely distressed, perhaps loud, pacing, or visibly restless and overwhelmed.)

### Center and Slow the Moment

"I can see (or hear) how agitated you are. Let‚Äôs take a pause for a second. I‚Äôm right here with you. You don‚Äôt have to go through this moment alone."
"It‚Äôs okay to feel everything you‚Äôre feeling. I just want to help you not feel so overwhelmed by it all at once. Can we try to take one slow breath together?"

### Acknowledge the Anger/Frustration

"That energy and anger you‚Äôre feeling right now ‚Äî it makes sense. Something important is going on inside you and it‚Äôs demanding to be heard."
"This anger is telling us something important. I hear that you‚Äôve been pushed to your limit. I‚Äôm listening."

### Keep Voice Calm & Assuring

"I‚Äôm not going anywhere. I know you‚Äôre really upset, and it‚Äôs okay. Let‚Äôs stay right here. You‚Äôre safe with me to let it out, as long as we keep each other safe."

If they are pacing or shaking:  
"It‚Äôs okay if you need to move. I‚Äôll move a bit with you. Let‚Äôs walk together and breathe, no rush."

### Encourage Expression vs. Explosion

"Let‚Äôs slow this down and sit with what‚Äôs coming up, instead of letting it boil over or shutting it down. What‚Äôs the strongest thing on your mind right now? I‚Äôm here to listen."
"You don‚Äôt have to hold back ‚Äî I can handle whatever it is. Go ahead and tell me what‚Äôs going on, I‚Äôm listening."

### Validation

"Anyone in your situation would feel upset. It‚Äôs okay to feel this. We just want to keep it from hurting you or anyone else while it‚Äôs so strong."
"You have every right to feel the way you do. Let‚Äôs channel it in a way that helps you, not hurts you."

### Grounding in Present

If they seem disoriented by emotion:  
"Look at me for a second and take a breath. We‚Äôre right here, in this room (or on this call). You‚Äôre doing okay. Just keep breathing. That‚Äôs it."

### After Calming Slightly ‚Äì Reflection

"That was a lot. You did really well slowing down just now. This is hard stuff, and you‚Äôre handling it. When you‚Äôre ready, maybe we can figure out what you need next or how I can help further."
"I know you‚Äôre still upset, but you‚Äôre also in control right now ‚Äî you‚Äôre talking to me and breathing, and that‚Äôs a big win. We‚Äôll let your therapist know how hard this was for you today."
        `
      },
      {
        id: "acute-anxiety",
        title: "Acute Anxiety or Panic Attack",
        content: `
(Client is panicked ‚Äì rapid breathing, fear of dying or losing control, chest tightness, etc.)

### Immediate Physiological Regulation (TIPP Skills)

"Right now, your body is in fight-or-flight mode. Let's try something called TIPP to help calm your nervous system quickly."
"First, let's try Temperature. Can you splash some cold water on your face, or hold a cold water bottle or ice cube if you have one? This triggers something called the 'dive response' that naturally slows your heart rate."
[If they can't access cold, continue with breathing]
"Now let's try Paced Breathing. We're going to breathe together in a way that tells your nervous system it's safe to calm down. Breathe in through your nose for 4 counts... hold for 4... now out through your mouth for 6."
[Breathe with them for several cycles]
"How does that feel? Even a small shift means your body is starting to move out of panic mode."

### Grounding Through Somatic Anchors

"Let's try a simple grounding technique. Can you bring your attention to your feet on the floor? Just notice the sensation of contact, the solid ground beneath you. This quietly reminds your nervous system that you‚Äôre safe right now."
"Now, place one hand on your heart and one on your belly. Feel the warmth of your own touch. This is your body's way of sending itself a message of comfort and safety."
"Let's try the 5-4-3-2-1 technique. Can you name 5 things you can see around you? ... 4 things you can touch? ... 3 things you can hear? ... 2 things you can smell? ... 1 thing you can taste? This brings you back to the present."

### Defusing from Anxious Thoughts

"I'm hearing some really anxious thoughts like '[repeat their specific worry].' Right now, these thoughts feel absolutely true and urgent. Let's try something - can you add this phrase: 'I'm having the thought that...' Sometimes adding that phrase can help you see the thought as just a mental event - something your anxious mind is producing - rather than a prediction of the future."
        `
      },
      // ...continue with the rest of your Orange Zone scenarios...
    ]
};

clinicalData.yellow = {
    title: "üü® Yellow Zone ‚Äì Moderate Challenges",
    color: "yellow",
    scenarios: [
      {
        id: "shame-guilt",
        title: "Shame, Self-Hatred, or Guilt",
        content: `
(Client expresses strong negative feelings about themselves: ‚ÄúI hate myself,‚Äù ‚ÄúI‚Äôm a terrible person,‚Äù or overwhelming guilt over something.)

### Immediately Counter Global Negativity

"I hear you saying some really harsh things about yourself. I know those feelings are very real for you right now. But I have to tell you, from where I sit, you are not a terrible person. You‚Äôre a human being who‚Äôs clearly in pain."

"I hear you saying, ‚ÄòI‚Äôm a terrible person.‚Äô Let‚Äôs try and reframe that. Is it more accurate to say, ‚ÄòI did something I regret‚Äô? There‚Äôs a big difference between being a failure and doing something you regret or are ashamed of."

"It sounds like you‚Äôre holding yourself to an impossible standard. Whatever you did (or think you did), it doesn‚Äôt make you worthless or evil. It makes you human."

### Get Specific (if possible)

"Can we talk about what‚Äôs making you feel so ashamed? What do you believe you did that‚Äôs so unforgivable?"

If client opens up about it:  
"Thank you for telling me. I know it‚Äôs hard to even say it out loud. From an outside perspective, I see someone who made a mistake (if it was a mistake) or had something happen to them ‚Äî not someone who is bad."

If they say ‚Äúeverything‚Äù or can‚Äôt specify:  
"That feeling like every single thing about you is wrong ‚Äì that‚Äôs a heavy blanket of shame. Usually, that comes from messages you‚Äôve gotten over time, not from one thing. We can talk about that if you want."

### Empathy and Common Humanity

"I want you to imagine if your best friend came to you and confessed the exact same thing you‚Äôre feeling guilty about. Would you tell them they‚Äôre a horrible person? Probably not. You‚Äôd likely feel compassion for them. You deserve that same compassion."

"One mistake or even a handful of them don‚Äôt define your entire character. We are all a mix of good and not-so-good actions. What matters is you care ‚Äì and I can see you do care, because you feel so much guilt or shame."

### Challenge Cognitive Distortions (gently)

"It sounds like you believe that because X happened, you are 100% bad. Let‚Äôs test that a bit: Have you ever done something kind or good in your life? (They might say no.) I can list at least one ‚Äî you‚Äôre talking to me right now, asking for help, and that‚Äôs brave."

"Let‚Äôs try a hypothetical: If someone makes a mistake at work, does that make them a mistake as a person? Likely you‚Äôd say no, of course not. So why is it different for you? Why is the bar for you so much higher?"

### Separate Actions from Self

"Maybe you did something you regret. That action might have been harmful, and we can acknowledge that and make amends if possible. But you are not equal to that action. You are a whole person, and that part is just one chapter, not the whole story."

If it‚Äôs guilt:  
"Is there anything you can or want to do to make the situation better or to apologize? Sometimes taking responsible action can lessen guilt. And once you‚Äôve done what you can, it‚Äôs okay to let it go. You don‚Äôt have to punish yourself forever."

If it‚Äôs shame (feeling you ARE bad):  
"Shame often comes from how others treated you. It could be that you were made to feel ‚Äònot good enough‚Äô growing up or in some relationship. That voice in your head is not the truth ‚Äî it‚Äôs a story you learned, and we can work on unlearning it."

### Encourage Self-Compassion

"You know, you have survived 100% of your worst days so far, and you‚Äôre still trying. That tells me you‚Äôre resilient and you care. Maybe try talking to yourself as you would to a dear friend: you don‚Äôt have to love yourself, but you can at least try to be less harsh."

"What if we come up with one small affirmation or even a neutral statement you can tell yourself when the self-hatred creeps in? Even something like, ‚ÄòI‚Äôm human and I‚Äôm learning,‚Äô or ‚ÄòI have worth even if I mess up.‚Äô"
        `
      },
      // ...continue with the rest of your Yellow Zone scenarios...
    ]clinicalData.green = {
    title: "üíö Green Zone ‚Äì Growth & Skill-Building",
    color: "green",
    scenarios: [
      {
        id: "time-management",
        title: "Time Management and Organization",
        content: `
### Time Management and Organization

- Use behavioral activation and scheduling.
- Try habit stacking and reinforcement.
- Use checklists, planners, and phone reminders.
        `
      },
      {
        id: "building-habits",
        title: "Building Healthy Habits & Routines",
        content: `
### Building Healthy Habits & Routines

- Use habit stacking and reinforcement.
- Set up small, achievable goals and track progress.
        `
      },
      {
        id: "values-clarification",
        title: "Values Clarification & Life Transitions",
        content: `
### Values Clarification & Life Transitions

- Use values exploration and meaning-making strategies.
- Focus on radical acceptance and support-building during life changes.
        `
      }
      // Continue adding Green Zone scenarios as needed, following the CLINICALX.txt
    ]
};

//////////////////////////// UI LOGIC ////////////////////////////

const MAIN_TABS = [
    { id: 'dashboard', icon: 'layout-dashboard', label: 'Dashboard' },
    { id: 'favorites', icon: 'star', label: 'Favorites' },
    { id: 'recents', icon: 'clock', label: 'Recents' },
    { id: 'interventions', icon: 'activity', label: 'Interventions' }
];
const colorMap = {
    red: { border: 'border-red-500' },
    orange: { border: 'border-orange-500' },
    yellow: { border: 'border-yellow-500' },
    green: { border: 'border-green-500' },
    indigo: { border: 'border-indigo-500' }
};
const dom = {};
const state = {
    currentView: 'dashboard',
    favorites: [],
    recentlyViewed: [],
    customContent: {},
    contentMap: new Map()
};

function populateDomObject() {
    [
        'sidebar-nav', 'content-area', 'user-id-display',
        'modalTitle', 'modalBody', 'scenarioModal', 'closeModal', 'toast'
    ].forEach(id => {
        const camel = id.replace(/-([a-z])/g, g => g[1].toUpperCase());
        dom[camel] = document.getElementById(id);
    });
}

function showToast(message, isSubtle = false) {
    dom.toast.textContent = message;
    dom.toast.className = `fixed bottom-5 right-5 text-white py-2 px-4 rounded-lg shadow-lg z-50 ${isSubtle ? 'bg-gray-600 dark:bg-gray-700' : 'bg-green-500'}`;
    dom.toast.classList.remove('hidden');
    setTimeout(() => { dom.toast.classList.add('hidden'); }, 3000);
}

function initializeDataMap() {
    state.contentMap.clear();
    Object.values(clinicalData).forEach(zone => {
        zone.scenarios.forEach(s => state.contentMap.set(s.id, {...s, category: zone.title, color: zone.color}));
    });
    Object.entries(interventionsData).forEach(([category, items]) => {
        items.forEach(item => state.contentMap.set(item.id, {...item, category, color: 'indigo'}));
    });
    Object.values(state.customContent).forEach(item => state.contentMap.set(item.id, item));
}

// ---- Sidebar Tabs ----
function renderSidebarTabs() {
    const nav = dom.sidebarNav;
    nav.innerHTML = '';
    MAIN_TABS.forEach(tab => {
        const btn = document.createElement('button');
        btn.className = `sidebar-link w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left font-medium transition-colors${state.currentView === tab.id ? ' active' : ''}`;
        btn.dataset.tab = tab.id;
        btn.innerHTML = `<i data-lucide="${tab.icon}" class="h-5 w-5"></i> <span>${tab.label}</span>`;
        btn.addEventListener('click', () => switchView(tab.id));
        nav.appendChild(btn);
    });
    lucide.createIcons();
}

// ---- Tab Switching ----
function switchView(viewId) {
    state.currentView = viewId;
    document.querySelectorAll('.sidebar-link').forEach(link => {
        link.classList.toggle('active', link.dataset.tab === viewId);
    });
    dom.contentArea.innerHTML = '';

    if (viewId === 'dashboard') {
        const dashboardItems = Array.from(state.contentMap.values()).filter(item => item.category && item.category.includes('Zone'));
        renderCardList(dom.contentArea, dashboardItems, 'No scenarios found.');
    } else if (viewId === 'favorites') {
        const items = state.favorites.map(id => state.contentMap.get(id)).filter(Boolean);
        renderCardList(dom.contentArea, items, 'No favorites yet.');
    } else if (viewId === 'recents') {
        const items = state.recentlyViewed.map(id => state.contentMap.get(id)).filter(Boolean);
        renderCardList(dom.contentArea, items, 'No recently viewed scenarios.');
    } else if (viewId === 'interventions') {
        const items = [];
        Object.entries(interventionsData).forEach(([cat, arr]) => items.push(...arr));
        renderCardList(dom.contentArea, items, 'No interventions found.');
    }
}

// ---- Cards ----
function renderCardList(container, items, emptyMessage) {
    if (!container) return;
    container.innerHTML = '';
    if (items.length === 0) {
        container.innerHTML = `<p class="text-center text-gray-500 dark:text-gray-400 p-8 col-span-full">${emptyMessage}</p>`;
        return;
    }
    items.forEach(item => {
        if (item) container.appendChild(createScenarioCard(item));
    });
    lucide.createIcons();
}
function createScenarioCard(scenario) {
    const isFavorited = state.favorites.includes(scenario.id);
    const colors = colorMap[scenario.color] || colorMap.indigo;
    const card = document.createElement('div');
    card.className = `scenario-card bg-white dark:bg-gray-800 p-4 rounded-lg cursor-pointer flex flex-col justify-between relative ${colors.border}`;
    card.dataset.id = scenario.id;
    card.innerHTML = `
        <div class="flex-1">
            <h3 class="font-semibold pr-2 text-gray-800 dark:text-gray-200">${scenario.title}</h3>
        </div>
        <div class="favorite-star self-end mt-2 text-gray-400 dark:text-gray-600 ${isFavorited ? 'favorited' : ''}" style="z-index:2;">
            <i data-lucide="star" class="h-5 w-5"></i>
        </div>`;
    card.querySelector('.favorite-star').addEventListener('click', (e) => {
        e.stopPropagation();
        toggleFavorite(scenario.id);
    });
    card.addEventListener('click', () => openModal(scenario));
    return card;
}

// ---- Modal ----
function openModal(scenario) {
    if (!scenario) return;
    state.currentOpenScenario = scenario;
    dom.modalTitle.textContent = scenario.title;
    dom.modalBody.innerHTML = marked.parse(scenario.content);
    dom.scenarioModal.classList.remove('hidden');
    addToRecentlyViewed(scenario.id);
    lucide.createIcons();
}
dom.closeModal?.addEventListener('click', () => {
    dom.scenarioModal.classList.add('hidden');
});

// ---- Favorites & Recents ----
function toggleFavorite(scenarioId) {
    const idx = state.favorites.indexOf(scenarioId);
    if (idx === -1) {
        state.favorites.unshift(scenarioId);
    } else {
        state.favorites.splice(idx, 1);
    }
    switchView(state.currentView);
}
function addToRecentlyViewed(scenarioId) {
    const idx = state.recentlyViewed.indexOf(scenarioId);
    if (idx !== -1) state.recentlyViewed.splice(idx, 1);
    state.recentlyViewed.unshift(scenarioId);
    if (state.recentlyViewed.length > 10) state.recentlyViewed.pop();
}

// ---- Main ----
function main() {
    populateDomObject();
    renderSidebarTabs();
    initializeDataMap();
    switchView(state.currentView || 'dashboard');
    // Theme toggle
    document.getElementById('theme-toggle').addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
    });
}
document.addEventListener('DOMContentLoaded', main);
</script>
</body>
</html>
};
const interventionsData = {
  "Distress Tolerance": [
    {
      id: "tipp",
      title: "TIPP (Rapid Distress Reduction)",
      content: `
**TIPP Skill for Rapid Distress Reduction**

- **Temperature:** Splash cold water on your face or hold ice to your neck for a temperature shock.
- **Intense Exercise:** Do jumping jacks, run in place, or do push-ups for 30-60 seconds.
- **Paced Breathing:** Inhale for 4 counts, exhale for 6-8 counts.
- **Paired Muscle Relaxation:** Clench all muscles tightly, then relax. Repeat.

> "Sometimes the body just needs a jolt to interrupt the overwhelm. Let‚Äôs try a quick temperature shock: we could splash a bit of cold water on your face or hold this cold bottle against your neck. Or try clenching all your muscles tight for a few seconds ‚Äî squeeze your fists, arms, even your legs ‚Äî and then release. We‚Äôll do it a few times."
      `
    }
    // Add more interventions here, expanded from CLINICALX.txt
  ],
  "Cognitive Skills": [
    {
      id: "defusion",
      title: "Defusion (Unhooking from Unhelpful Thoughts)",
      content: `
Let‚Äôs try something with that painful thought that keeps popping up. Say to yourself, ‚ÄòI‚Äôm noticing that I‚Äôm having the thought that ______,‚Äô and fill in the blank with whatever your mind‚Äôs saying.

"I know it sounds funny, but you might try thanking your mind for that thought. Like, ‚ÄòThanks mind, for trying to protect me,‚Äô even if the thought is really negative. Sometimes just naming it out loud gives you a little space from it."
      `
    }
    // Add more cognitive skills interventions here
  ],
  "Self-Compassion": [
    {
      id: "self-compassion",
      title: "Self-Compassion",
      content: `
Think about what you would say to a close friend if they were feeling exactly what you‚Äôre feeling. You deserve that same kindness. What if you tried talking to yourself in the same compassionate way? Let‚Äôs find a small way you can be kind to yourself in this moment. It could be as simple as taking a slow breath and saying, ‚ÄòI‚Äôm doing my best, and that‚Äôs enough right now.‚Äô
      `
    }
    // Add more self-compassion interventions here
  ],
  "Session End": [
    {
      id: "end-of-session",
      title: "(End-of-Session) ‚úÖ Survey‚Üí",
      content: `
Survey link:  
https://charliehealth.qualtrics.com/jfe/form/SV_aYkIr219RLNs0Sy?name=Ashley_R

‚ÄúBefore you go back to group, I do have a brief survey that I‚Äôm required to provide. It's very short, just a thumbs up or thumbs down. Do you see the link in the chat?‚Äù
‚ÄúGreat! Let me know when you are done and then I will get you back into group.‚Äù
      `
    }
    // Add more session end interventions here
  ]
};
